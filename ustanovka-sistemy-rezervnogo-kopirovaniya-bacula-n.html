<!DOCTYPE html>
<html lang="ru">
<head>

        <title>Установка системы резервного копирования Bacula 5.0 на CentOS 6</title>
        <meta charset="utf-8" />
        <link href="http://yavorovych.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="История одной жизни Full Atom Feed" />
        <link href="http://yavorovych.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="История одной жизни Full RSS Feed" />
        <link href="http://yavorovych.com/feeds/unix.atom.xml" type="application/atom+xml" rel="alternate" title="История одной жизни Categories Atom Feed" />
        <link href="http://yavorovych.com/feeds/unix.rss.xml" type="application/rss+xml" rel="alternate" title="История одной жизни Categories RSS Feed" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="http://yavorovych.com/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="http://yavorovych.com/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="http://yavorovych.com/theme/pygment.css" />

        <script src="http://yavorovych.com/theme/js/libs/modernizr-2.6.2.min.js"></script>






</head>

<body id="index" class="home">


    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="http://yavorovych.com">История одной жизни <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="http://yavorovych.com">Home</a></li>


              </ul>
            </div>

<section id="content" class="body">

   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
                <a href="http://yavorovych.com/ustanovka-sistemy-rezervnogo-kopirovaniya-bacula-n.html" rel="bookmark"
                   title="Permalink to Установка системы резервного копирования Bacula 5.0 на CentOS 6">Установка системы резервного копирования Bacula 5.0 на CentOS 6</a></h2>
           
            </header>
            <footer class="post-info">
              <abbr class="published" title="2012-01-03T18:22:11">
                Tue 03 January 2012
              </abbr>
              <address class="vcard author">
                By <a class="url fn" href="http://yavorovych.com/author/daniel-iavorovich.html">Даниэль Яворович</a>
              </address>
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <p>Всем доброго времени суток!</p>
<p>Сегодня я расскажу о продвинутой системе для создания резервных копий -
<a href="http://www.bacula.org/">Bacula</a>.</p>
<p>Это статья призвана донести общую информацию о работе Bacula на примере её
установки на CentOS 6. В Base-репозитории CentOS 6 на данный момент вирсия
продукта 5.0. На её примере и будет построена документация.</p>
<p>Статья сама по себе может оказаться полезной, но прежде, чем ринуться
применять полученные знания на в production-решениях я настоятельно советую
ознакомится с <a href="http://www.bacula.org/en/?page=documentation">официальной
документацией</a> и ответить себе
на несколько вопросов:</p>
<ul>
<li><strong><em>Я использую rsync/tar/самописные скрипты - зачем мне что то ещё?</em></strong></li>
</ul>
<p><em>В таком случае Вам, скорее всего, не нужна Bacula. Эта система рассчитана на
более масштабные задачи, чем бекап одного-двух серверов. Она позволяет
организовывать централизированную распределённую систему бекепов практически
чего угодно и куда угодно, включая возможность записи dvd-диски и магнитную
ленту стримера.</em></p>
<ul>
<li><strong><em>Сейчас я произвожу бекап данных по протоколам, что поддерживаются многими ОС (таких как ftp или samba). Смогу ли я делать что то подобное с Bacula?</em></strong></li>
</ul>
<p><em>Bacula не поддерживает сторонние протоколы передачи данных, а использует
свой. Но это давольно кросплатформенный продукт. Так что Вы сможете
производить бекапы даже компьютеров с Windows.</em></p>
<p>Итак, немного теории.</p>
<h2>Теория</h2>
<p>Bacula состоит из нескольких независимых компонентов: Director, Console, File,
Storage и сервисы мониторинга.</p>
<p><img alt="Структура Bacula" src="/blog/2012/ustanovka-sistemy-rezervnogo-kopirovaniya-" /></p>
<h3>Bacula Director</h3>
<p>Bacula Director выполняет функции "директора" над всеми остальными сервисами -
запускает создание резервных копий и операции восстановление из бекапов,
управляет сервисами хранения данных (<strong><em>Bacula Storage</em></strong>), отсылке
уведомлений и т.д.</p>
<h3>Bacula Console</h3>
<p>Bacula Console служит для управления Bacula Director. Она имеет 3 версии
интерфейса: _ CLI _ QT-based * wxWidgets CLI лично меня всем устраивает, но
GUI у Bacula так же не уступают возможностями, что не может не радовать.</p>
<h3>Bacula File</h3>
<p>Bacula File (так же известна, как Клиентская часть) - это сервис, что
устанавливается на узлы, данные которого нужно резервировать. Существуют
версии для разных ОС. Все файлы доступны на <a href="http://sourceforge.net/projects/bacula/files/#files">странице
sourceforge</a>.</p>
<h3>Bacula Storage</h3>
<p>Bacula Storage - это сервис, основной целью которого есть управление хранением
данных с резервными копиями. Другими словами Bacula Storage используется
Bacula Director для чтения / записи данных с клентских машин, информация
которых резервируется.</p>
<h3>Catalog</h3>
<p>Catalog используется для хранения данных о бекепах, файлах, хранилищах и
всего, с чем работает Bacula Director. Catalog может использовать для хранения
данных различные БД, среди которых MySQL, PostgreSQL и SQLite.</p>
<h3>Bacula Monitor</h3>
<p>Bacula Monitor - это приложение, по даёт ифнормацию о состоянии Bacula
Director и его задачах. Это могут быть состояния тех или иных задач
(создание/восстановление резервных копий), доступность сервисов Bacula и т.д.
Существует несколько вариаций Bacula Monitor - все из них используют GTK+ и
работают как в KDE, GNOME так и других рабочих окружениях.</p>
<h2>Установка</h2>
<h3>SELinux disable</h3>
<div class="highlight"><pre><span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s">&quot;s/SELINUX=.*/SELINUX=disabled/g&quot;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">selinux</span>
<span class="n">setenforce</span> <span class="mi">0</span>
</pre></div>


<h3>MySQL Server</h3>
<p>Мы будем использовать БД MySQL для хранения данных Bacula.</p>
<p>Выполняем установку:</p>
<div class="highlight"><pre><span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">mysql</span><span class="o">-</span><span class="n">server</span> <span class="n">mysql</span><span class="o">-</span><span class="n">devel</span>
</pre></div>


<p>Запускаем MySQL-server и добавляем его init-скрипт в автозагрузку:</p>
<div class="highlight"><pre><span class="n">service</span> <span class="n">mysqld</span> <span class="n">start</span>
<span class="n">chkconfig</span> <span class="n">mysqld</span> <span class="n">on</span>
</pre></div>


<p>Генерируем пароль для root-пользователя MySQL, устанавливаем его и добавляем в
/root/.my.cnf, чтобы будучи в shell от root иметь беспарольный доступ в MySQL
Shell от имени суперпользователя.</p>
<div class="highlight"><pre>MATRIX=&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;
LENGTH=&quot;10&quot;
while [ &quot;<span class="cp">${</span><span class="n">n</span><span class="p">:</span><span class="o">=</span><span class="mi">1</span><span class="cp">}</span>&quot; -le &quot;<span class="nv">$LENGTH</span>&quot; ]; do PASS=&quot;<span class="nv">$PASS</span><span class="cp">${</span><span class="n">MATRIX</span><span class="p">:</span><span class="err">$</span><span class="p">((</span><span class="err">$</span><span class="n">RANDOM</span><span class="o">%</span><span class="err">$</span><span class="p">{</span><span class="c">#MATRIX</span><span class="cp">}</span>)):1}&quot;; let n+=1; done
echo -e &quot;[client]
user=root
password=<span class="nv">$PASS</span>&quot; &gt; /root/.my.cnf
/usr/bin/mysqladmin -u root password <span class="nv">$PASS</span>
PASS=&quot;&quot;
n=&quot;&quot;
</pre></div>


<h3>Bacula services</h3>
<p>В нашем примере будет использовано 2 физических сервера. На первом будут
установлены Director, File, Storage и Catalog (для бекапа данного сервера,
хранения данных и управления всеми сервисами), а на втором будет расположен
исключительно Bacula Client для создания бекапов данных на 2 сервере.</p>
<h4>Server 2: Bacula Client</h4>
<p>Как это ни странно - мы начнём настройку с второго сервера, клиентского. Я
посчитал, что настраивать доступы к клиентской части и после указывать их в
основном конфиге директора проще, чем делать это в обратной
последовательности.</p>
<p>Устанавливаем клиентскую часть на сервер, что будем бекапить.</p>
<div class="highlight"><pre><span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">bacula</span><span class="o">-</span><span class="n">client</span>
</pre></div>


<p>Правим конфиг <strong>/etc/bacula/bacula-fd.conf</strong> указывая пароли доступа к Bacula
Client (Поля Password) для Директора и tray-monitor.</p>
<div class="highlight"><pre><span class="n">Director</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">bacula</span><span class="o">-</span><span class="n">dir</span>
  <span class="n">Password</span> <span class="o">=</span> <span class="s">&quot;DIRBASSWORD&quot;</span>
<span class="p">}</span>
<span class="n">Director</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">bacula</span><span class="o">-</span><span class="n">mon</span>
  <span class="n">Password</span> <span class="o">=</span> <span class="s">&quot;MOPASSWORD&quot;</span>
  <span class="n">Monitor</span> <span class="o">=</span> <span class="n">yes</span>
<span class="p">}</span>
<span class="n">FileDaemon</span> <span class="p">{</span>                          <span class="err">#</span> <span class="n">this</span> <span class="n">is</span> <span class="n">me</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">bacula</span><span class="o">-</span><span class="n">fd</span>
  <span class="n">FDport</span> <span class="o">=</span> <span class="mi">9102</span>                  <span class="err">#</span> <span class="n">where</span> <span class="n">we</span> <span class="n">listen</span> <span class="k">for</span> <span class="n">the</span> <span class="n">director</span>
  <span class="n">WorkingDirectory</span> <span class="o">=</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">spool</span><span class="o">/</span><span class="n">bacula</span>
  <span class="n">Pid</span> <span class="n">Directory</span> <span class="o">=</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span>
  <span class="n">Maximum</span> <span class="n">Concurrent</span> <span class="n">Jobs</span> <span class="o">=</span> <span class="mi">20</span>
<span class="p">}</span>
<span class="n">Messages</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">Standard</span>
  <span class="n">director</span> <span class="o">=</span> <span class="n">bacula</span><span class="o">-</span><span class="n">dir</span> <span class="o">=</span> <span class="n">all</span><span class="p">,</span> <span class="o">!</span><span class="n">skipped</span><span class="p">,</span> <span class="o">!</span><span class="n">restored</span>
<span class="p">}</span>
</pre></div>


<p>Запускаем сервис и добавляем его в автозагрузку:</p>
<div class="highlight"><pre><span class="n">service</span> <span class="n">bacula</span><span class="o">-</span><span class="n">fd</span> <span class="n">start</span>
<span class="n">chkconfig</span> <span class="n">bacula</span><span class="o">-</span><span class="n">fd</span> <span class="n">on</span>
</pre></div>


<p><strong><em>Во время настройки у меня небыло выделенного домена, который бы резолвился на всех используемых серверах для bacula-sd, и я наткнулся на проблему, когда бекап не мог запуститься, ругаясь следующим образом:</em></strong></p>
<blockquote>
<p>Bad response to Storage command: wanted 2000 OK storage</p>
</blockquote>
<p>Как оказалось - Bacula Client обращается к Bacula Storage напрямую и т.к. я
указывал fqdn в конфигурации bacula-dir, который не резолвился, но был на
сервере Bacula Director, а на сервере, где расположен Bacula Client в host
соответствующей записи небыло, клиент и не мог подключится.</p>
<p><strong>Решение</strong>: все сервера в системе Bacula должны иметь доступ к доменам, что указаны в конфигурационных файлах.</p>
<h4>Server 1: Bacula Director, Catalog, Storage</h4>
<p>Теперь переходим к основной части - настройке Директора (Director), что хранит
данные в MySQL (посредством Catalog) и сервиса хранения данных бекапов
(Storage).</p>
<h5>Установка пакетов через YAM</h5>
<div class="highlight"><pre><span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">bacula</span><span class="o">-</span><span class="n">storage</span><span class="o">-</span><span class="n">mysql</span> <span class="n">bacula</span><span class="o">-</span><span class="n">director</span><span class="o">-</span><span class="n">mysql</span> <span class="n">bacula</span><span class="o">-</span><span class="n">console</span>
</pre></div>


<h5>Настройка базы и пользователя MySQL для работы с Bacula</h5>
<p>Теперь создадим MySQL-пользователя, базу данных и расставим нужные привилегии.</p>
<div class="highlight"><pre><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">libexec</span><span class="o">/</span><span class="n">bacula</span><span class="o">/</span><span class="n">grant_mysql_privileges</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">libexec</span><span class="o">/</span><span class="n">bacula</span><span class="o">/</span><span class="n">create_mysql_database</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">libexec</span><span class="o">/</span><span class="n">bacula</span><span class="o">/</span><span class="n">make_mysql_tables</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">libexec</span><span class="o">/</span><span class="n">bacula</span><span class="o">/</span><span class="n">grant_bacula_privileges</span>
</pre></div>


<p>Сгенерируем пароль для MySQL-пользователя bacula и установим его.</p>
<div class="highlight"><pre>MATRIX=&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&quot;
LENGTH=&quot;10&quot;
while [ &quot;<span class="cp">${</span><span class="n">n</span><span class="p">:</span><span class="o">=</span><span class="mi">1</span><span class="cp">}</span>&quot; -le &quot;<span class="nv">$LENGTH</span>&quot; ]; do PASS=&quot;<span class="nv">$PASS</span><span class="cp">${</span><span class="n">MATRIX</span><span class="p">:</span><span class="err">$</span><span class="p">((</span><span class="err">$</span><span class="n">RANDOM</span><span class="o">%</span><span class="err">$</span><span class="p">{</span><span class="c">#MATRIX</span><span class="cp">}</span>)):1}&quot;; let n+=1; done
BACULA_MYSQL_PASS=&quot;<span class="nv">$PASS</span>&quot;
PASS=&quot;&quot;
n=&quot;&quot;
mysql -e &quot;UPDATE mysql.user SET password=PASSWORD(&#39;<span class="nv">$BACULA_MYSQL_PASS</span>&#39;) WHERE user=&#39;bacula&#39;; flush privileges;&quot;
sed -i &quot;s/dbpassword.*/dbpassword = &quot;<span class="nv">$BACULA_MYSQL_PASS</span>&quot;/g&quot; /etc/bacula/bacula-dir.conf
</pre></div>


<h5>Конфигурация Storage</h5>
<p>Создадим каталог на сервере, где мы будем хранить бекапы. Он должен
располагаться на самом большом и незанятом разделе, переполнения которого, по
возможности, не нарушит работу всей системы и/или других сервисов. В данном
случае я расположу его в /backups/, куда будет монтироваться нужный мне
раздел.</p>
<div class="highlight"><pre><span class="n">mkdir</span> <span class="o">/</span><span class="n">backups</span><span class="o">/</span>
</pre></div>


<p>Настроим на Bacula Storage в конфигурационном файле <strong>/etc/bacula/bacula-
sd.conf</strong>:</p>
<div class="highlight"><pre><span class="n">Storage</span> <span class="p">{</span>                             <span class="err">#</span> <span class="n">definition</span> <span class="n">of</span> <span class="n">myself</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">bacula</span><span class="o">-</span><span class="n">sd</span>
  <span class="n">SDPort</span> <span class="o">=</span> <span class="mi">9103</span>                  <span class="err">#</span> <span class="n">Director</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">port</span>

  <span class="n">WorkingDirectory</span> <span class="o">=</span> <span class="s">&quot;/var/spool/bacula&quot;</span>
  <span class="n">Pid</span> <span class="n">Directory</span> <span class="o">=</span> <span class="s">&quot;/var/run&quot;</span>
  <span class="n">Maximum</span> <span class="n">Concurrent</span> <span class="n">Jobs</span> <span class="o">=</span> <span class="mi">20</span>
<span class="p">}</span>
<span class="n">Director</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">bacula</span><span class="o">-</span><span class="n">dir</span>
  <span class="n">Password</span> <span class="o">=</span> <span class="s">&quot;SDPASSWORD&quot;</span>
<span class="p">}</span>
<span class="n">Director</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">bacula</span><span class="o">-</span><span class="n">mon</span>
  <span class="n">Password</span> <span class="o">=</span> <span class="s">&quot;MODPASSWORD&quot;</span>
  <span class="n">Monitor</span> <span class="o">=</span> <span class="n">yes</span>
<span class="p">}</span>
<span class="n">Device</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">FileStorage</span>
  <span class="n">Media</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">File</span>
  <span class="n">Archive</span> <span class="n">Device</span> <span class="o">=</span> <span class="o">/</span><span class="n">backups</span>
  <span class="n">LabelMedia</span> <span class="o">=</span> <span class="n">yes</span><span class="p">;</span>                   <span class="err">#</span> <span class="n">lets</span> <span class="n">Bacula</span> <span class="n">label</span> <span class="n">unlabeled</span> <span class="n">media</span>
  <span class="n">Random</span> <span class="n">Access</span> <span class="o">=</span> <span class="n">Yes</span><span class="p">;</span>
  <span class="n">AutomaticMount</span> <span class="o">=</span> <span class="n">yes</span><span class="p">;</span>               <span class="err">#</span> <span class="n">when</span> <span class="n">device</span> <span class="n">opened</span><span class="p">,</span> <span class="n">read</span> <span class="n">it</span>
  <span class="n">RemovableMedia</span> <span class="o">=</span> <span class="n">no</span><span class="p">;</span>
  <span class="n">AlwaysOpen</span> <span class="o">=</span> <span class="n">no</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">Messages</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">Standard</span>
  <span class="n">director</span> <span class="o">=</span> <span class="n">bacula</span><span class="o">-</span><span class="n">dir</span> <span class="o">=</span> <span class="n">all</span>
<span class="p">}</span>
</pre></div>


<p>Стартуем сервис и добавляем в автозагрузку:</p>
<div class="highlight"><pre><span class="n">service</span> <span class="n">bacula</span><span class="o">-</span><span class="n">sd</span> <span class="n">start</span>
<span class="n">chkconfig</span> <span class="n">bacula</span><span class="o">-</span><span class="n">sd</span> <span class="n">on</span>
</pre></div>


<h5>Конфигурация Director</h5>
<p>Теперь нужно задать пароли для всех поднимаемых сервисов.</p>
<p>Открываем конфигурационный файл Директора <strong>/etc/bacula/bacula-dir.conf</strong> и
выполняем его настройку, указывая доступы к Storage и Client, а так же к
самому Bacula Server:</p>
<div class="highlight"><pre><span class="n">Director</span> <span class="p">{</span>                            <span class="err">#</span> <span class="n">define</span> <span class="n">myself</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">bacula</span><span class="o">-</span><span class="n">dir</span>
  <span class="n">DIRport</span> <span class="o">=</span> <span class="mi">9101</span>                <span class="err">#</span> <span class="n">where</span> <span class="n">we</span> <span class="n">listen</span> <span class="k">for</span> <span class="n">UA</span> <span class="n">connections</span>
  <span class="n">QueryFile</span> <span class="o">=</span> <span class="s">&quot;/usr/libexec/bacula/query.sql&quot;</span>
  <span class="n">WorkingDirectory</span> <span class="o">=</span> <span class="s">&quot;/var/spool/bacula&quot;</span>
  <span class="n">PidDirectory</span> <span class="o">=</span> <span class="s">&quot;/var/run&quot;</span>
  <span class="n">Maximum</span> <span class="n">Concurrent</span> <span class="n">Jobs</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">Password</span> <span class="o">=</span> <span class="s">&quot;DIRPASSWORD&quot;</span>         <span class="err">#</span> <span class="n">Console</span> <span class="n">password</span>
  <span class="n">Messages</span> <span class="o">=</span> <span class="n">Daemon</span>
<span class="p">}</span>
<span class="n">JobDefs</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="s">&quot;DefaultJob&quot;</span>
  <span class="n">Type</span> <span class="o">=</span> <span class="n">Backup</span>
  <span class="n">Level</span> <span class="o">=</span> <span class="n">Incremental</span>
  <span class="n">FileSet</span> <span class="o">=</span> <span class="s">&quot;Full Set&quot;</span>
  <span class="n">Schedule</span> <span class="o">=</span> <span class="s">&quot;WeeklyCycle&quot;</span>
  <span class="n">Storage</span> <span class="o">=</span> <span class="n">File</span>
  <span class="n">Messages</span> <span class="o">=</span> <span class="n">Standard</span>
  <span class="n">Pool</span> <span class="o">=</span> <span class="n">File</span>
  <span class="n">Priority</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="n">Write</span> <span class="n">Bootstrap</span> <span class="o">=</span> <span class="s">&quot;/var/spool/bacula/%c.bsr&quot;</span>
<span class="p">}</span>
  <span class="err">#</span> <span class="n">This</span> <span class="n">creates</span> <span class="n">an</span> <span class="n">ASCII</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">the</span> <span class="n">catalog</span>
  <span class="err">#</span> <span class="n">Arguments</span> <span class="n">to</span> <span class="n">make_catalog_backup</span><span class="p">.</span><span class="n">pl</span> <span class="n">are</span><span class="o">:</span>
  <span class="err">#</span>  <span class="n">make_catalog_backup</span><span class="p">.</span><span class="n">pl</span> 
  <span class="err">#</span> <span class="n">This</span> <span class="n">deletes</span> <span class="n">the</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">the</span> <span class="n">catalog</span>
<span class="n">Job</span> <span class="p">{</span>
  <span class="n">Name</span>          <span class="o">=</span> <span class="s">&quot;BackupMyServ&quot;</span>
  <span class="n">JobDefs</span>       <span class="o">=</span> <span class="s">&quot;DefaultJob&quot;</span>
  <span class="n">Client</span>        <span class="o">=</span> <span class="n">myserv</span>
  <span class="n">FileSet</span>       <span class="o">=</span> <span class="s">&quot;myserv&quot;</span>
<span class="p">}</span> 
<span class="n">FileSet</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="s">&quot;myserv&quot;</span>
  <span class="n">Include</span> <span class="p">{</span>
    <span class="n">Options</span> <span class="p">{</span>
      <span class="n">signature</span> <span class="o">=</span> <span class="n">MD5</span> <span class="err">#Для</span> <span class="err">сверки</span> <span class="err">используем</span> <span class="n">MD5</span>
      <span class="n">Compression</span><span class="o">=</span><span class="n">GZIP</span> <span class="err">#Используем</span> <span class="n">GZIP</span> <span class="err">компрессию</span>
    <span class="p">}</span>
    <span class="n">File</span> <span class="o">=</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span>
    <span class="n">File</span> <span class="o">=</span> <span class="o">/</span><span class="n">backups</span><span class="o">/</span>
    <span class="n">File</span> <span class="o">=</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">FileSet</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="s">&quot;Full Set&quot;</span>
  <span class="n">Include</span> <span class="p">{</span>
    <span class="n">Options</span> <span class="p">{</span>
      <span class="n">signature</span> <span class="o">=</span> <span class="n">MD5</span>
    <span class="p">}</span>
    <span class="n">File</span> <span class="o">=</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span>
  <span class="p">}</span>
  <span class="n">Exclude</span> <span class="p">{</span>
    <span class="n">File</span> <span class="o">=</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">spool</span><span class="o">/</span><span class="n">bacula</span>
    <span class="n">File</span> <span class="o">=</span> <span class="o">/</span><span class="n">tmp</span>
    <span class="n">File</span> <span class="o">=</span> <span class="o">/</span><span class="n">proc</span>
    <span class="n">File</span> <span class="o">=</span> <span class="o">/</span><span class="n">tmp</span>
    <span class="n">File</span> <span class="o">=</span> <span class="o">/</span><span class="p">.</span><span class="n">journal</span>
    <span class="n">File</span> <span class="o">=</span> <span class="o">/</span><span class="p">.</span><span class="n">fsck</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">Schedule</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="s">&quot;WeeklyCycle&quot;</span>
  <span class="n">Run</span> <span class="o">=</span> <span class="n">Full</span> <span class="mi">1</span><span class="n">st</span> <span class="n">sun</span> <span class="n">at</span> <span class="mi">23</span><span class="o">:</span><span class="mo">05</span>
  <span class="n">Run</span> <span class="o">=</span> <span class="n">Differential</span> <span class="mi">2</span><span class="n">nd</span><span class="o">-</span><span class="mi">5</span><span class="n">th</span> <span class="n">sun</span> <span class="n">at</span> <span class="mi">23</span><span class="o">:</span><span class="mo">05</span>
  <span class="n">Run</span> <span class="o">=</span> <span class="n">Incremental</span> <span class="n">mon</span><span class="o">-</span><span class="n">sat</span> <span class="n">at</span> <span class="mi">23</span><span class="o">:</span><span class="mo">05</span>
<span class="p">}</span>
<span class="n">Schedule</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="s">&quot;WeeklyCycleAfterBackup&quot;</span>
  <span class="n">Run</span> <span class="o">=</span> <span class="n">Full</span> <span class="n">sun</span><span class="o">-</span><span class="n">sat</span> <span class="n">at</span> <span class="mi">23</span><span class="o">:</span><span class="mi">10</span>
<span class="p">}</span>
<span class="n">FileSet</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="s">&quot;Catalog&quot;</span>
  <span class="n">Include</span> <span class="p">{</span>
    <span class="n">Options</span> <span class="p">{</span>
      <span class="n">signature</span> <span class="o">=</span> <span class="n">MD5</span>
    <span class="p">}</span>
    <span class="n">File</span> <span class="o">=</span> <span class="s">&quot;/var/spool/bacula/bacula.sql&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">Client</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">myserv</span>
  <span class="n">Address</span> <span class="o">=</span> <span class="n">myserv</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
  <span class="n">FDPort</span> <span class="o">=</span> <span class="mi">9102</span>
  <span class="n">Catalog</span> <span class="o">=</span> <span class="n">MyCatalog</span>
  <span class="n">Password</span> <span class="o">=</span> <span class="s">&quot;CLIENTPASS&quot;</span>          <span class="err">#</span> <span class="n">password</span> <span class="k">for</span> <span class="n">FileDaemon</span>
  <span class="n">File</span> <span class="n">Retention</span> <span class="o">=</span> <span class="mi">30</span> <span class="n">days</span>            <span class="err">#</span> <span class="mi">30</span> <span class="n">days</span>
  <span class="n">Job</span> <span class="n">Retention</span> <span class="o">=</span> <span class="mi">6</span> <span class="n">months</span>            <span class="err">#</span> <span class="n">six</span> <span class="n">months</span>
  <span class="n">AutoPrune</span> <span class="o">=</span> <span class="n">yes</span>                     <span class="err">#</span> <span class="n">Prune</span> <span class="n">expired</span> <span class="n">Jobs</span><span class="o">/</span><span class="n">Files</span>
<span class="p">}</span>
<span class="n">Storage</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">File</span>
  <span class="n">Address</span> <span class="o">=</span> <span class="n">backup</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>                <span class="err">#</span> <span class="n">N</span><span class="p">.</span><span class="n">B</span><span class="p">.</span> <span class="n">Use</span> <span class="n">a</span> <span class="n">fully</span> <span class="n">qualified</span> <span class="n">name</span> <span class="n">here</span>
  <span class="n">SDPort</span> <span class="o">=</span> <span class="mi">9103</span>
  <span class="n">Password</span> <span class="o">=</span> <span class="s">&quot;STORAGEPASS&quot;</span>
  <span class="n">Device</span> <span class="o">=</span> <span class="n">FileStorage</span>
  <span class="n">Media</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">File</span>
<span class="p">}</span>
<span class="n">Catalog</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">MyCatalog</span>
  <span class="n">dbname</span> <span class="o">=</span> <span class="s">&quot;bacula&quot;</span><span class="p">;</span> <span class="n">dbuser</span> <span class="o">=</span> <span class="s">&quot;bacula&quot;</span><span class="p">;</span> <span class="n">dbpassword</span> <span class="o">=</span> <span class="s">&quot;MYSQLPASS&quot;</span>
<span class="p">}</span>
<span class="n">Messages</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">Standard</span>
  <span class="n">mailcommand</span> <span class="o">=</span> <span class="s">&quot;/usr/sbin/bsmtp -h localhost -f &quot;</span><span class="p">(</span><span class="n">Bacula</span><span class="p">)</span> <span class="o">&lt;%</span><span class="n">r</span><span class="o">&gt;</span><span class="s">&quot; -s &quot;</span><span class="n">Bacula</span><span class="o">:</span> <span class="o">%</span><span class="n">t</span> <span class="o">%</span><span class="n">e</span> <span class="n">of</span> <span class="o">%</span><span class="n">c</span> <span class="o">%</span><span class="n">l</span><span class="s">&quot; %r&quot;</span>
  <span class="n">operatorcommand</span> <span class="o">=</span> <span class="s">&quot;/usr/sbin/bsmtp -h localhost -f &quot;</span><span class="p">(</span><span class="n">Bacula</span><span class="p">)</span> <span class="o">&lt;%</span><span class="n">r</span><span class="o">&gt;</span><span class="s">&quot; -s &quot;</span><span class="n">Bacula</span><span class="o">:</span> <span class="n">Intervention</span> <span class="n">needed</span> <span class="k">for</span> <span class="o">%</span><span class="n">j</span><span class="s">&quot; %r&quot;</span>
  <span class="n">mail</span> <span class="o">=</span> <span class="n">me</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="o">=</span> <span class="n">all</span><span class="p">,</span> <span class="o">!</span><span class="n">skipped</span>

  <span class="n">operator</span> <span class="o">=</span> <span class="n">dcshnik</span><span class="err">@</span><span class="n">hoster</span><span class="p">.</span><span class="n">com</span> <span class="o">=</span> <span class="n">mount</span>
  <span class="n">console</span> <span class="o">=</span> <span class="n">all</span><span class="p">,</span> <span class="o">!</span><span class="n">skipped</span><span class="p">,</span> <span class="o">!</span><span class="n">saved</span>
  <span class="n">append</span> <span class="o">=</span> <span class="s">&quot;/var/spool/bacula/log&quot;</span> <span class="o">=</span> <span class="n">all</span><span class="p">,</span> <span class="o">!</span><span class="n">skipped</span>
  <span class="n">catalog</span> <span class="o">=</span> <span class="n">all</span>
<span class="p">}</span>
<span class="n">Messages</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">Daemon</span>
  <span class="n">mailcommand</span> <span class="o">=</span> <span class="s">&quot;/usr/sbin/bsmtp -h localhost -f &quot;</span><span class="p">(</span><span class="n">Bacula</span><span class="p">)</span> <span class="o">&lt;%</span><span class="n">r</span><span class="o">&gt;</span><span class="s">&quot; -s &quot;</span><span class="n">Bacula</span> <span class="n">daemon</span> <span class="n">message</span><span class="s">&quot; %r&quot;</span>
  <span class="n">mail</span> <span class="o">=</span> <span class="n">root</span><span class="err">@</span><span class="n">localhost</span> <span class="o">=</span> <span class="n">all</span><span class="p">,</span> <span class="o">!</span><span class="n">skipped</span>

  <span class="n">console</span> <span class="o">=</span> <span class="n">all</span><span class="p">,</span> <span class="o">!</span><span class="n">skipped</span><span class="p">,</span> <span class="o">!</span><span class="n">saved</span>
  <span class="n">append</span> <span class="o">=</span> <span class="s">&quot;/var/log/bacula.log&quot;</span> <span class="o">=</span> <span class="n">all</span><span class="p">,</span> <span class="o">!</span><span class="n">skipped</span>
<span class="p">}</span>
<span class="n">Pool</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">Default</span>
  <span class="n">Pool</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">Backup</span>
  <span class="n">Recycle</span> <span class="o">=</span> <span class="n">yes</span>                       <span class="err">#</span> <span class="n">Bacula</span> <span class="n">can</span> <span class="n">automatically</span> <span class="n">recycle</span> <span class="n">Volumes</span>
  <span class="n">AutoPrune</span> <span class="o">=</span> <span class="n">yes</span>                     <span class="err">#</span> <span class="n">Prune</span> <span class="n">expired</span> <span class="n">volumes</span>
  <span class="n">Volume</span> <span class="n">Retention</span> <span class="o">=</span> <span class="mi">365</span> <span class="n">days</span>         <span class="err">#</span> <span class="n">one</span> <span class="n">year</span>
<span class="p">}</span>
<span class="n">Pool</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">File</span>
  <span class="n">Pool</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">Backup</span>
  <span class="n">Recycle</span> <span class="o">=</span> <span class="n">yes</span>                       <span class="err">#</span> <span class="n">Bacula</span> <span class="n">can</span> <span class="n">automatically</span> <span class="n">recycle</span> <span class="n">Volumes</span>
  <span class="n">AutoPrune</span> <span class="o">=</span> <span class="n">yes</span>                     <span class="err">#</span> <span class="n">Prune</span> <span class="n">expired</span> <span class="n">volumes</span>
  <span class="n">Volume</span> <span class="n">Retention</span> <span class="o">=</span> <span class="mi">365</span> <span class="n">days</span>         <span class="err">#</span> <span class="n">one</span> <span class="n">year</span>
  <span class="n">Maximum</span> <span class="n">Volume</span> <span class="n">Bytes</span> <span class="o">=</span> <span class="mi">400</span><span class="n">G</span>          <span class="err">#</span> <span class="n">Limit</span> <span class="n">Volume</span> <span class="n">size</span> <span class="n">to</span> <span class="n">something</span> <span class="n">reasonable</span>
  <span class="n">Maximum</span> <span class="n">Volumes</span> <span class="o">=</span> <span class="mi">1000</span>               <span class="err">#</span> <span class="n">Limit</span> <span class="n">number</span> <span class="n">of</span> <span class="n">Volumes</span> <span class="n">in</span> <span class="n">Pool</span>
<span class="p">}</span>
<span class="n">Pool</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">Scratch</span>
  <span class="n">Pool</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">Backup</span>
<span class="p">}</span>
<span class="n">Console</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">bacula</span><span class="o">-</span><span class="n">mon</span>
  <span class="n">Password</span> <span class="o">=</span> <span class="s">&quot;MODPASS&quot;</span>
  <span class="n">CommandACL</span> <span class="o">=</span> <span class="n">status</span><span class="p">,</span> <span class="p">.</span><span class="n">status</span>
<span class="p">}</span>
</pre></div>


<p>Запускаем директора и добавляем его в автозагрузку:</p>
<div class="highlight"><pre><span class="n">service</span> <span class="n">bacula</span><span class="o">-</span><span class="n">dir</span> <span class="n">start</span>
<span class="n">chkconfig</span> <span class="n">bacula</span><span class="o">-</span><span class="n">dir</span> <span class="n">on</span>
</pre></div>


<h5>Конфигурация Console</h5>
<p>Для управления Bacula существует несколько интерфейсов. Я предпочитаю CLI-
интефейс bconsole. Его мы сейчас и настроем в <strong>/etc/bacula/bconsole.conf</strong>:</p>
<div class="highlight"><pre><span class="n">Director</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="o">=</span> <span class="n">bacula</span><span class="o">-</span><span class="n">dir</span>
  <span class="n">DIRport</span> <span class="o">=</span> <span class="mi">9101</span>
  <span class="n">address</span> <span class="o">=</span> <span class="n">localhost</span>
  <span class="n">Password</span> <span class="o">=</span> <span class="s">&quot;DIRPASSWORD&quot;</span>
<span class="p">}</span>
</pre></div>


<p>Проверяем:</p>
<div class="highlight"><pre><span class="cp"># bconsole </span>
<span class="n">Connecting</span> <span class="n">to</span> <span class="n">Director</span> <span class="n">localhost</span><span class="o">:</span><span class="mi">9101</span>
<span class="mi">1000</span> <span class="n">OK</span><span class="o">:</span> <span class="n">bacula</span><span class="o">-</span><span class="n">dir</span> <span class="n">Version</span><span class="o">:</span> <span class="mf">5.0.0</span> <span class="p">(</span><span class="mi">26</span> <span class="n">January</span> <span class="mi">2010</span><span class="p">)</span>
<span class="n">Enter</span> <span class="n">a</span> <span class="n">period</span> <span class="n">to</span> <span class="n">cancel</span> <span class="n">a</span> <span class="n">command</span><span class="p">.</span>
<span class="o">*</span><span class="n">quit</span>
</pre></div>


<p>Доступ есть. Переходим к настройке бекапов и первому, тестовому запуску
задания.</p>
<h5>Создание volume и тестовый запуск бекапов</h5>
<div class="highlight"><pre><span class="cp"># bconsole </span>
<span class="n">Connecting</span> <span class="n">to</span> <span class="n">Director</span> <span class="n">localhost</span><span class="o">:</span><span class="mi">9101</span>
<span class="mi">1000</span> <span class="n">OK</span><span class="o">:</span> <span class="n">bacula</span><span class="o">-</span><span class="n">dir</span> <span class="n">Version</span><span class="o">:</span> <span class="mf">5.0.0</span> <span class="p">(</span><span class="mi">26</span> <span class="n">January</span> <span class="mi">2010</span><span class="p">)</span>
<span class="n">Enter</span> <span class="n">a</span> <span class="n">period</span> <span class="n">to</span> <span class="n">cancel</span> <span class="n">a</span> <span class="n">command</span><span class="p">.</span>
<span class="o">*</span><span class="n">label</span>
<span class="n">Automatically</span> <span class="n">selected</span> <span class="n">Catalog</span><span class="o">:</span> <span class="n">MyCatalog</span>
<span class="n">Using</span> <span class="n">Catalog</span> <span class="s">&quot;MyCatalog&quot;</span>
<span class="n">Automatically</span> <span class="n">selected</span> <span class="n">Storage</span><span class="o">:</span> <span class="n">File</span>
<span class="n">Enter</span> <span class="n">new</span> <span class="n">Volume</span> <span class="n">name</span><span class="o">:</span> <span class="n">TestVolume</span>
<span class="n">Defined</span> <span class="n">Pools</span><span class="o">:</span>
     <span class="mi">1</span><span class="o">:</span> <span class="n">Default</span>
     <span class="mi">2</span><span class="o">:</span> <span class="n">File</span>
     <span class="mi">3</span><span class="o">:</span> <span class="n">Scratch</span>
<span class="n">Select</span> <span class="n">the</span> <span class="n">Pool</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">:</span> <span class="mi">2</span>
</pre></div>


<p>Запускаем процесс бекапа клиента:</p>
<div class="highlight"><pre><span class="cp"># bconsole </span>
<span class="n">Connecting</span> <span class="n">to</span> <span class="n">Director</span> <span class="n">localhost</span><span class="o">:</span><span class="mi">9101</span>
<span class="mi">1000</span> <span class="n">OK</span><span class="o">:</span> <span class="n">bacula</span><span class="o">-</span><span class="n">dir</span> <span class="n">Version</span><span class="o">:</span> <span class="mf">5.0.0</span> <span class="p">(</span><span class="mi">26</span> <span class="n">January</span> <span class="mi">2010</span><span class="p">)</span>
<span class="n">Enter</span> <span class="n">a</span> <span class="n">period</span> <span class="n">to</span> <span class="n">cancel</span> <span class="n">a</span> <span class="n">command</span><span class="p">.</span>
<span class="o">*</span><span class="n">run</span>
<span class="n">Automatically</span> <span class="n">selected</span> <span class="n">Catalog</span><span class="o">:</span> <span class="n">MyVolume</span>
<span class="n">Using</span> <span class="n">Catalog</span> <span class="s">&quot;MyVolume&quot;</span>
<span class="n">A</span> <span class="n">job</span> <span class="n">name</span> <span class="n">must</span> <span class="n">be</span> <span class="n">specified</span><span class="p">.</span>
<span class="n">Automatically</span> <span class="n">selected</span> <span class="n">Job</span><span class="o">:</span> <span class="n">BackupMyServer</span>
<span class="n">Run</span> <span class="n">Backup</span> <span class="n">job</span>
<span class="nl">JobName:</span>  <span class="n">BackupMyServer</span>
<span class="nl">Level:</span>    <span class="n">Incremental</span>
<span class="nl">Client:</span>   <span class="n">pm</span>
<span class="nl">FileSet:</span>  <span class="n">pm</span>
<span class="nl">Pool:</span>     <span class="n">File</span> <span class="p">(</span><span class="n">From</span> <span class="n">Job</span> <span class="n">resource</span><span class="p">)</span>
<span class="nl">Storage:</span>  <span class="n">File</span> <span class="p">(</span><span class="n">From</span> <span class="n">Job</span> <span class="n">resource</span><span class="p">)</span>
<span class="nl">When:</span>     <span class="mi">2012</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mi">14</span> <span class="mo">03</span><span class="o">:</span><span class="mi">25</span><span class="o">:</span><span class="mi">50</span>
<span class="nl">Priority:</span> <span class="mi">10</span>
<span class="n">OK</span> <span class="n">to</span> <span class="n">run</span><span class="o">?</span> <span class="p">(</span><span class="n">yes</span><span class="o">/</span><span class="n">mod</span><span class="o">/</span><span class="n">no</span><span class="p">)</span><span class="o">:</span> <span class="n">yes</span>
</pre></div>


<p>Задание отправится в очередь на выполнение. Просмотреть статус его работы
можно командой:</p>
<div class="highlight"><pre><span class="cp"># bconsole</span>

<span class="n">Connecting</span> <span class="n">to</span> <span class="n">Director</span> <span class="n">localhost</span><span class="o">:</span><span class="mi">9101</span>
<span class="mi">1000</span> <span class="n">OK</span><span class="o">:</span> <span class="n">bacula</span><span class="o">-</span><span class="n">dir</span> <span class="n">Version</span><span class="o">:</span> <span class="mf">5.0.0</span> <span class="p">(</span><span class="mi">26</span> <span class="n">January</span> <span class="mi">2010</span><span class="p">)</span>
<span class="n">Enter</span> <span class="n">a</span> <span class="n">period</span> <span class="n">to</span> <span class="n">cancel</span> <span class="n">a</span> <span class="n">command</span><span class="p">.</span>
<span class="o">*</span><span class="n">status</span> <span class="n">dir</span>
<span class="n">bacula</span><span class="o">-</span><span class="n">dir</span> <span class="n">Version</span><span class="o">:</span> <span class="mf">5.0.0</span> <span class="p">(</span><span class="mi">26</span> <span class="n">January</span> <span class="mi">2010</span><span class="p">)</span> <span class="n">i686</span><span class="o">-</span><span class="n">pc</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span> <span class="n">redhat</span> <span class="p">(</span><span class="n">Final</span><span class="p">)</span>
<span class="n">Daemon</span> <span class="n">started</span> <span class="mi">14</span><span class="o">-</span><span class="err">Ян</span><span class="o">-</span><span class="mi">2012</span> <span class="mo">03</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span> <span class="n">Jobs</span> <span class="n">run</span> <span class="n">since</span> <span class="n">started</span><span class="p">.</span>
 <span class="nl">Heap:</span> <span class="n">heap</span><span class="o">=</span><span class="mi">135</span><span class="p">,</span><span class="mi">168</span> <span class="n">smbytes</span><span class="o">=</span><span class="mi">88</span><span class="p">,</span><span class="mi">613</span> <span class="n">max_bytes</span><span class="o">=</span><span class="mi">89</span><span class="p">,</span><span class="mi">166</span> <span class="n">bufs</span><span class="o">=</span><span class="mi">311</span> <span class="n">max_bufs</span><span class="o">=</span><span class="mi">317</span>

<span class="n">Scheduled</span> <span class="n">Jobs</span><span class="o">:</span>
<span class="n">Level</span>          <span class="n">Type</span>     <span class="n">Pri</span>  <span class="n">Scheduled</span>          <span class="n">Name</span>               <span class="n">Volume</span>
<span class="o">===================================================================================</span>
<span class="n">Incremental</span>    <span class="n">Backup</span>    <span class="mi">10</span>  <span class="mi">14</span><span class="o">-</span><span class="err">Ян</span><span class="o">-</span><span class="mi">2012</span> <span class="mi">23</span><span class="o">:</span><span class="mo">05</span> <span class="n">BackupMyServer</span>           <span class="n">MyVolume</span>
<span class="o">====</span>

<span class="n">Running</span> <span class="n">Jobs</span><span class="o">:</span>
<span class="n">Console</span> <span class="n">connected</span> <span class="n">at</span> <span class="mi">14</span><span class="o">-</span><span class="err">Ян</span><span class="o">-</span><span class="mi">2012</span> <span class="mo">03</span><span class="o">:</span><span class="mi">10</span>
<span class="n">Console</span> <span class="n">connected</span> <span class="n">at</span> <span class="mi">14</span><span class="o">-</span><span class="err">Ян</span><span class="o">-</span><span class="mi">2012</span> <span class="mo">03</span><span class="o">:</span><span class="mi">10</span>
<span class="n">Console</span> <span class="n">connected</span> <span class="n">at</span> <span class="mi">14</span><span class="o">-</span><span class="err">Ян</span><span class="o">-</span><span class="mi">2012</span> <span class="mo">03</span><span class="o">:</span><span class="mi">28</span>
 <span class="n">JobId</span> <span class="n">Level</span>   <span class="n">Name</span>                       <span class="n">Status</span>
<span class="o">======================================================================</span>
     <span class="mi">9</span> <span class="n">Full</span>    <span class="n">BackupMyServer</span><span class="mf">.2012</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mi">14</span><span class="n">_03</span><span class="mf">.11.25</span><span class="n">_04</span> <span class="n">is</span> <span class="n">running</span>
    <span class="mi">10</span> <span class="n">Full</span>    <span class="n">BackupMyServer</span><span class="mf">.2012</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mi">14</span><span class="n">_03</span><span class="mf">.26.03</span><span class="n">_06</span> <span class="n">is</span> <span class="n">waiting</span> <span class="n">execution</span>
<span class="o">====</span>
<span class="o">*</span>
</pre></div>


<h2>Заключение</h2>
<p>Как видно из документации <em>Bacula</em> - это не самая быстроконфигурируемая
система резервного копирования, но её гибкость и масштабируемость позволяет
поддерживать системы почти что любого уровня сложности и различных задач. В
руководстве, как уже было сказано, была описана базовый установка, что даёт
хорошее представление о том, как это будет работать и главное - имеет ли смысл
идти дальше и разворачивать свою систему Bacula.</p>
            </div><!-- /.entry-content -->
            <div class="comments">
              <h3>Comments</h3>
              <div id="disqus_thread"></div>
              <script type="text/javascript">
                var disqus_identifier = "ustanovka-sistemy-rezervnogo-kopirovaniya-bacula-n.html";
                (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://danielyavorovichblog.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
              </script>
            </div>


        </div><!-- /.eleven.columns -->
        
<div class="three columns">

<h4>Pages</h4>

 <ul>
  </ul>

<h4>Categories</h4>
<ul>
		<li><a href="http://yavorovych.com/category/life.html">Life</a></li>
		<li><a href="http://yavorovych.com/category/thinking.html">Thinking</a></li>
		<li><a href="http://yavorovych.com/category/unix.html">Unix</a></li>
</ul>


<h4>Tags</h4>
	<ul>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/signal.html">signal</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/journal.html">journal</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/powerdns.html">powerdns</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/hosting4django.html">hosting4django</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/fairplay.html">fairplay</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/gimp.html">gimp</a></li>
	    <li class="tag-1"><a href="http://yavorovych.com/tag/django.html">django</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/monitoring.html">monitoring</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/blog.html">blog</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/ext4.html">ext4</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/zabbix.html">zabbix</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/testing.html">testing</a></li>
	    <li class="tag-1"><a href="http://yavorovych.com/tag/clean.html">clean</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/automatiozation.html">automatiozation</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/sqlite3_load_extension.html">sqlite3_load_extension</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/sqlite.html">sqlite</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/3d.html">3d</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/tune2fs.html">tune2fs</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/migration.html">migration</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/ext3.html">ext3</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/unity.html">unity</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/websocket.html">websocket</a></li>
	    <li class="tag-1"><a href="http://yavorovych.com/tag/python.html">python</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/s3.html">s3</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/fts.html">fts</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/templates.html">templates</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/fs.html">fs</a></li>
	    <li class="tag-1"><a href="http://yavorovych.com/tag/puppet.html">puppet</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/recreate.html">recreate</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/kharkov.html">kharkov</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/webmoney.html">webmoney</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/cache.html">cache</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/euro2012.html">euro2012</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/s3fs.html">s3fs</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/zoohelp.html">zoohelp</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/launcher.html">launcher</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/virtualenv.html">virtualenv</a></li>
	    <li class="tag-4"><a href="http://yavorovych.com/tag/amazon.html">amazon</a></li>
	    <li class="tag-1"><a href="http://yavorovych.com/tag/ubuntu.html">ubuntu</a></li>
</ul>


<nav class="widget">
  <h4>Social</h4>
  <ul>
    <li><a href="https://github.com/daniel-yavorovich">github</a></li>
  </ul>
</nav>

</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">

                <li><div class="btn primary"><a href="https://github.com/daniel-yavorovich" target="_blank">Github</a></div></li>




              </ul>
            </div>
          </div>
        </footer>

    </div>


<script type="text/javascript">
    var disqus_shortname = 'danielyavorovichblog';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
  <script src="http://yavorovych.com/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="http://yavorovych.com/theme/js/libs/gumby.min.js"></script>
  <script src="http://yavorovych.com/theme/js/plugins.js"></script>

</body>
</html>