<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>История одной жизни</title><link href="http://yavorovych.com/" rel="alternate"></link><link href="http://yavorovych.com/feeds/unix.atom.xml" rel="self"></link><id>http://yavorovych.com/</id><updated>2013-11-22T14:04:00+02:00</updated><entry><title>Миграция на github</title><link href="http://yavorovych.com/migration-to-the-github.html" rel="alternate"></link><updated>2013-11-22T14:04:00+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2013-11-22:migration-to-the-github.html</id><summary type="html">&lt;p&gt;Всем привет!&lt;/p&gt;
&lt;p&gt;Вот и меня постигла участь олдскульного подхода к хостингу блогозаписей - статические страницы.&lt;/p&gt;
&lt;p&gt;Мой выбор пал на:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://blog.getpelican.com/"&gt;Pelican&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://pages.github.com/"&gt;GitHub Pages&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Статьи пишу в Markdown, отдельное спасибо за &lt;a href="https://github.com/aaronsw/html2text"&gt;Html2Text&lt;/a&gt; - очень удобный инструмент,
что без труда помог конвертироватьв се мои блогозаписи в строгий md.&lt;/p&gt;
&lt;p&gt;Признаюсь, что Pelican неплох. Если бы я писал blog engine, то он бы был хуже Pelican.&lt;/p&gt;
&lt;p&gt;Статические сайты снова в моде.
Всем мир!&lt;/p&gt;</summary><category term="blog"></category><category term="migration"></category><category term="github"></category></entry><entry><title>RPM SQLite 3.7.1</title><link href="http://yavorovych.com/rpm-sqlite-371.html" rel="alternate"></link><updated>2012-11-03T14:15:45+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-11-03:rpm-sqlite-371.html</id><summary type="html">&lt;p&gt;Привет, привет! Сегодня в одном из проектов у моего хорошего приятеля
потребовалось поддержка fts3/fts4 и возможность подключать дополнения(
sqlite3_load_extension()). Многие на моём месте сразу пойду делать "configure;
make; make install". Многие, но не я. Собрать пакет с поддержкой всего этого
добра - задача очень тривиальная. Я использую CentOS 6.3 64-bit, но помимо
пакета выкладываю и spec-файл, что позволит Вам сделать rpm для любой
архитектуры.&lt;/p&gt;
&lt;p&gt;spec:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;%define realver 3071200&lt;/span&gt;
&lt;span class="c"&gt;%define docver 3071200&lt;/span&gt;
&lt;span class="c"&gt;%define rpmver 3.7.12&lt;/span&gt;

&lt;span class="n"&gt;Summary&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;        &lt;span class="n"&gt;Library&lt;/span&gt; &lt;span class="n"&gt;that&lt;/span&gt; &lt;span class="n"&gt;implements&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;embeddable&lt;/span&gt; &lt;span class="n"&gt;SQL&lt;/span&gt; &lt;span class="n"&gt;database&lt;/span&gt; &lt;span class="n"&gt;engine&lt;/span&gt;
&lt;span class="n"&gt;Name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;           &lt;span class="n"&gt;sqlite&lt;/span&gt;
&lt;span class="n"&gt;Version&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;        &lt;span class="c"&gt;%{rpmver}&lt;/span&gt;
&lt;span class="n"&gt;Release&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;        &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="c"&gt;%{?dist}&lt;/span&gt;
&lt;span class="n"&gt;License&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;        &lt;span class="n"&gt;Public&lt;/span&gt; &lt;span class="n"&gt;Domain&lt;/span&gt;
&lt;span class="n"&gt;Group&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;          &lt;span class="n"&gt;Applications&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Databases&lt;/span&gt;
&lt;span class="n"&gt;URL&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;            &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sqlite&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
&lt;span class="n"&gt;Source0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;        &lt;span class="n"&gt;sqlite&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;autoconf&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="c"&gt;%{realver}.tar.gz&lt;/span&gt;

&lt;span class="n"&gt;BuildRequires&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="n"&gt;ncurses&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;devel&lt;/span&gt; &lt;span class="n"&gt;readline&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;devel&lt;/span&gt; &lt;span class="n"&gt;glibc&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;devel&lt;/span&gt;

&lt;span class="n"&gt;BuildRoot&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;      &lt;span class="c"&gt;%{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)&lt;/span&gt;

&lt;span class="c"&gt;%description&lt;/span&gt;
&lt;span class="n"&gt;SQLite&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;C&lt;/span&gt; &lt;span class="n"&gt;library&lt;/span&gt; &lt;span class="n"&gt;that&lt;/span&gt; &lt;span class="n"&gt;implements&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;SQL&lt;/span&gt; &lt;span class="n"&gt;database&lt;/span&gt; &lt;span class="n"&gt;engine&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;large&lt;/span&gt;
&lt;span class="n"&gt;subset&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;SQL92&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;supported&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;complete&lt;/span&gt; &lt;span class="n"&gt;database&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;stored&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
&lt;span class="n"&gt;single&lt;/span&gt; &lt;span class="n"&gt;disk&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="n"&gt;The&lt;/span&gt; &lt;span class="n"&gt;API&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;designed&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;convenience&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt; &lt;span class="n"&gt;ease&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;use&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="n"&gt;Applications&lt;/span&gt; &lt;span class="n"&gt;that&lt;/span&gt; &lt;span class="n"&gt;link&lt;/span&gt; &lt;span class="n"&gt;against&lt;/span&gt; &lt;span class="n"&gt;SQLite&lt;/span&gt; &lt;span class="n"&gt;can&lt;/span&gt; &lt;span class="n"&gt;enjoy&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;power&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt;
&lt;span class="n"&gt;flexibility&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;SQL&lt;/span&gt; &lt;span class="n"&gt;database&lt;/span&gt; &lt;span class="n"&gt;without&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;administrative&lt;/span&gt; &lt;span class="n"&gt;hassles&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt;
&lt;span class="n"&gt;supporting&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;separate&lt;/span&gt; &lt;span class="n"&gt;database&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;  &lt;span class="n"&gt;Version&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt; &lt;span class="n"&gt;version&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="n"&gt;binaries&lt;/span&gt;
&lt;span class="n"&gt;are&lt;/span&gt; &lt;span class="n"&gt;named&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;permit&lt;/span&gt; &lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;installed&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;single&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt;

&lt;span class="c"&gt;%package devel&lt;/span&gt;
&lt;span class="n"&gt;Summary&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Development&lt;/span&gt; &lt;span class="n"&gt;tools&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;sqlite3&lt;/span&gt; &lt;span class="n"&gt;embeddable&lt;/span&gt; &lt;span class="n"&gt;SQL&lt;/span&gt; &lt;span class="n"&gt;database&lt;/span&gt; &lt;span class="n"&gt;engine&lt;/span&gt;
&lt;span class="n"&gt;Group&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Development&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Libraries&lt;/span&gt;
&lt;span class="n"&gt;Requires&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="c"&gt;%{name} = %{version}-%{release}&lt;/span&gt;
&lt;span class="n"&gt;Requires&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;pkgconfig&lt;/span&gt;

&lt;span class="c"&gt;%description devel&lt;/span&gt;
&lt;span class="n"&gt;This&lt;/span&gt; &lt;span class="n"&gt;package&lt;/span&gt; &lt;span class="n"&gt;contains&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;header&lt;/span&gt; &lt;span class="n"&gt;files&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt; &lt;span class="n"&gt;development&lt;/span&gt; &lt;span class="n"&gt;documentation&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="c"&gt;%{name}. If you like to develop programs using %{name}, you will need&lt;/span&gt;
&lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="c"&gt;%{name}-devel.&lt;/span&gt;

&lt;span class="c"&gt;%prep&lt;/span&gt;
&lt;span class="c"&gt;%setup -n %{name}-autoconf-%{realver}&lt;/span&gt;

&lt;span class="c"&gt;%build&lt;/span&gt;
&lt;span class="n"&gt;export&lt;/span&gt; &lt;span class="n"&gt;CPPFLAGS&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&amp;quot;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;DSQLITE_ENABLE_FTS3&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;DSQLITE_ENABLE_FTS3_PARENTHESIS&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;DSQLITE_ENABLE_LOAD_EXTENSION&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&amp;quot;
&lt;span class="c"&gt;%configure&lt;/span&gt;
&lt;span class="n"&gt;make&lt;/span&gt;

&lt;span class="c"&gt;%install&lt;/span&gt;
&lt;span class="n"&gt;rm&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rf&lt;/span&gt; $&lt;span class="n"&gt;RPM_BUILD_ROOT&lt;/span&gt;
&lt;span class="n"&gt;make&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;DESTDIR&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;$&lt;span class="n"&gt;RPM_BUILD_ROOT&lt;/span&gt;

&lt;span class="c"&gt;%clean&lt;/span&gt;
&lt;span class="n"&gt;rm&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;rf&lt;/span&gt; $&lt;span class="n"&gt;RPM_BUILD_ROOT&lt;/span&gt;
&lt;span class="n"&gt;make&lt;/span&gt; &lt;span class="n"&gt;clean&lt;/span&gt;

&lt;span class="c"&gt;%files&lt;/span&gt;
&lt;span class="c"&gt;%defattr(-, root, root)&lt;/span&gt;
&lt;span class="c"&gt;%doc README&lt;/span&gt;
&lt;span class="c"&gt;%{_bindir}/sqlite3&lt;/span&gt;
&lt;span class="c"&gt;%{_libdir}/*.so.*&lt;/span&gt;
&lt;span class="c"&gt;%{_mandir}/man?/*&lt;/span&gt;

&lt;span class="c"&gt;%files devel&lt;/span&gt;
&lt;span class="c"&gt;%defattr(-, root, root)&lt;/span&gt;
&lt;span class="c"&gt;%{_includedir}/*.h&lt;/span&gt;
&lt;span class="c"&gt;%{_libdir}/*.so&lt;/span&gt;
&lt;span class="c"&gt;%{_libdir}/pkgconfig/*.pc&lt;/span&gt;
&lt;span class="c"&gt;%{_libdir}/*.a&lt;/span&gt;
&lt;span class="c"&gt;%exclude %{_libdir}/*.la&lt;/span&gt;

&lt;span class="c"&gt;%changelog&lt;/span&gt;
&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;Sat&lt;/span&gt; &lt;span class="n"&gt;Nov&lt;/span&gt;  &lt;span class="mi"&gt;3&lt;/span&gt;  &lt;span class="mi"&gt;2012&lt;/span&gt; &lt;span class="n"&gt;Daniel&lt;/span&gt; &lt;span class="n"&gt;Yavorovich&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mf"&gt;3.7&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;Thu&lt;/span&gt; &lt;span class="n"&gt;May&lt;/span&gt; &lt;span class="mi"&gt;17&lt;/span&gt; &lt;span class="mi"&gt;2012&lt;/span&gt; &lt;span class="n"&gt;Nicola&lt;/span&gt; &lt;span class="n"&gt;Asuni&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mf"&gt;3.7&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;First&lt;/span&gt; &lt;span class="n"&gt;version&lt;/span&gt; &lt;span class="n"&gt;or&lt;/span&gt; &lt;span class="n"&gt;autoconf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;RPMs для CentOS 6.3 - x86_64 во вложении&lt;/p&gt;
&lt;p&gt;Искренне желаю Андрею поскорее стабилизироваться и отдыхать в выходные :)&lt;/p&gt;</summary><category term="fts"></category><category term="sqlite3_load_extension"></category><category term="sqlite"></category><category term="clean"></category></entry><entry><title>Создание 3d-изображенй в Gimp</title><link href="http://yavorovych.com/gimp-3d.html" rel="alternate"></link><updated>2012-10-10T15:34:17+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-10-10:gimp-3d.html</id><summary type="html">&lt;p&gt;Здравствуйте, сегодня я хочу рассказать о способе создания 3d-изображений (для
просмотра требуются очки с красной и синей линзами - так называемые red/blue
glass).&lt;/p&gt;
&lt;p&gt;Итак, первым шагом является создание 2 фотографий объекта с разных ракурсов.
Как правило, для таких целей используется 2 фотокамеры, что находятся на
расстоянии человеческих глаз друг от друга.&lt;/p&gt;
&lt;p&gt;В моём же случае я использовал 1 камеру, canon sx20is, но фотографировал
объект с двух ракурсов.&lt;/p&gt;
&lt;p&gt;После получения левого и правого изображения можно приступать к работе.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Откройте правое изображение в Gimp.&lt;/li&gt;
&lt;li&gt;Выберите в поле указания цвета #FF0000 (ярко-красный, его эквивалент в RGB: R-255 G-000 B-000)&lt;/li&gt;
&lt;li&gt;Создайте новый слой и залейте его выбранным цветом.&lt;/li&gt;
&lt;li&gt;Дублируйте получившийся слой и выполните инвертацию цвета (Layer &amp;gt; Colors &amp;gt; Invert)&lt;/li&gt;
&lt;li&gt;Выберите в списке слоёв красный слой и откройте левое фото, как новый слой (File &amp;gt; Open as Layer). Теперь в списке слоёв Вы видите список из четырёх слоёв, что начинается сверху с красного и заканчивается правой фото.&lt;/li&gt;
&lt;li&gt;Теперь Вы можете выключить видимость созданных цветовых слоёв (убрать галочку напротив глазика в списке слоёв) и сделать левый слой прозрачным на 50%, чтобы откорректировать высоту изображения, если во время съёмки были ошибки. После правок верните видимость слоя до 100% и включите назад красный и голубой слои.&lt;/li&gt;
&lt;li&gt;Выберите голубой слой и измените режим на Screen (поле выбора над списком слоёв, называемое Mode)&lt;/li&gt;
&lt;li&gt;Выключите видимость красного и последнего слоя (правое фото)&lt;/li&gt;
&lt;li&gt;Объедините 2 видимых слоя (левое фото и голубой слой): Image &amp;gt; Merge Visible&lt;/li&gt;
&lt;li&gt;Полученный слой сделайте невидимым.&lt;/li&gt;
&lt;li&gt;Включите обратно слои, что были выключены в пункте 8 и выполните миграцию голубого слоя и правого фото, как это было сделано в пункте 9&lt;/li&gt;
&lt;li&gt;Включите 2 полученных слоя и измените их режим на Multiply.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Вот и всё! Теперь Вы можете надевать очки и наслаждаться 3D фото!&lt;/p&gt;
&lt;p&gt;В качестве примера прилагаю 3D-фото своей подруги Герды:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Gerda 3D" src="/images/gimp-3d/gerda.jpg" /&gt;&lt;/p&gt;
&lt;p&gt;За основу взята инструкция с
http://graphicssoft.about.com/od/gimp/ht/3danaglyph.-UkA.htm&lt;/p&gt;</summary><category term="gimp"></category><category term="3d"></category></entry><entry><title>Написание модуля puppet</title><link href="http://yavorovych.com/napisanie-modulya-puppet.html" rel="alternate"></link><updated>2012-10-09T10:59:15+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-10-09:napisanie-modulya-puppet.html</id><summary type="html">&lt;p&gt;Всем привет! Данная статья ориентирована на специалистов, что уже имеют некий
опыт работы с Puppet и хотели бы упорядочить свои конфигурации в модули,
сделав их более прозрачными в управлении.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Что такое Puppet? Puppet - это система автоматизации управления. Основная её отрасль применения&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;упрощение установки поддержки множества серверов и сервисов, храня настройки в едином месте.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Что из себя представляет модуль Puppet? Это набор библиотек, классов, шаблонов и простых файлов, что собраны в одном месте, сгруппировавшись по темам (темой может быть сервис или группа сервисов для какой то серверной роли).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Где располагаются каталоги модулей Puppet'а? В open source версии Puppet каталогами с модулями являются, как правило в &lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;/etc/puppet/modules и /usr/share/puppet/modules&lt;/p&gt;
&lt;p&gt;Узнать точные пути можно командой&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;puppet&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="n"&gt;modulepath&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Процесс создания модуля Для начала создайте пустой каталог в одной из директорий расположения модулей, что была определена выше. Например, создадим модуль для управления фаерволом в Linux. Сперва создаём сам каталог модуля: &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;mkdir -p /etc/puppet/modules/iptables&lt;/p&gt;
&lt;p&gt;Теперь создаём единственный необходимый каталог и файл для корректной работы
модуля:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;mkdir&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;puppet&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;modules&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;iptables&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;manifests&lt;/span&gt;
&lt;span class="n"&gt;touch&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;puppet&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;modules&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;iptables&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;manifests&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pp&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь опишем класс конфигурации Iptables:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;tee&lt;/span&gt;  &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;puppet&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;modules&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;iptables&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;manifests&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pp&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;group&lt;/span&gt;   &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;mode&lt;/span&gt;    &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;644&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;source&lt;/span&gt;  &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;puppet:///iptables/rules.v4&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/etc/iptables/rules.v6&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;owner&lt;/span&gt;   &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;group&lt;/span&gt;   &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;mode&lt;/span&gt;    &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;644&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;source&lt;/span&gt;  &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;puppet:///iptables/rules.v6&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;EOF&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь разместим сами файлы, создав для них каталог в модуле:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;mkdir&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;puppet&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;modules&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;iptables&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;files&lt;/span&gt;
&lt;span class="n"&gt;touch&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;puppet&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;modules&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;iptables&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;files&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;rules&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;v4&lt;/span&gt;
&lt;span class="n"&gt;touch&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;puppet&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;modules&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;iptables&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;files&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;rules&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;v6&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Файлы заполните на своё усмотрение, размещать свой контент в них не в тематике
этой статьи :) Вот и всё! Инклудим нужные классы и всё готово! К примеру,
инклуд Iptables для всех год выглядит так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;# cat /etc/puppet/manifests/site.pp &lt;/span&gt;
&lt;span class="n"&gt;node&lt;/span&gt; &lt;span class="k"&gt;default&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;include&lt;/span&gt; &lt;span class="n"&gt;iptables&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Задавайте свои вопросы в комментариях.&lt;/p&gt;</summary><category term="puppet"></category><category term="automatiozation"></category></entry><entry><title>Очистка кеша файловой системы в Linux</title><link href="http://yavorovych.com/ochistka-kesha-fajlovoj-sistemy-v-linux.html" rel="alternate"></link><updated>2012-10-03T14:47:10+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-10-03:ochistka-kesha-fajlovoj-sistemy-v-linux.html</id><summary type="html">&lt;p&gt;Всё предельно просто. Делаем синк и очищаем все кеши (pagecache, dentrie и
inode)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;proc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;vm&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;drop_caches&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="clean"></category><category term="cache"></category><category term="fs"></category></entry><entry><title>Установка s3fs на Ubuntu</title><link href="http://yavorovych.com/ustanovka-s3fs-na-ubuntu.html" rel="alternate"></link><updated>2012-09-07T13:41:50+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-09-07:ustanovka-s3fs-na-ubuntu.html</id><summary type="html">&lt;p&gt;Привет! s3fs - это fuse-модуль для работы с Amazon s3, как с файловой
системой. Ставится всё предельно просто. Сперва установим необходимые
библиотеки и клиент SVN:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;aptitude&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;build&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;essential&lt;/span&gt; &lt;span class="n"&gt;libcurl4&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;openssl&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;libxml2&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;libfuse&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;comerr&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;libfuse2&lt;/span&gt; &lt;span class="n"&gt;libidn11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;libkadm55&lt;/span&gt; &lt;span class="n"&gt;libkrb5&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;libldap2&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;libselinux1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;libsepol1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;pkg&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="n"&gt;fuse&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;utils&lt;/span&gt; &lt;span class="n"&gt;subversion&lt;/span&gt; &lt;span class="n"&gt;autoconf2&lt;/span&gt;&lt;span class="mf"&gt;.13&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь выполним загрузку s3fs из SVN и установим его:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;mkdir&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="o"&gt;~/&lt;/span&gt;&lt;span class="n"&gt;install&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;cd&lt;/span&gt; &lt;span class="o"&gt;~/&lt;/span&gt;&lt;span class="n"&gt;install&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
&lt;span class="n"&gt;svn&lt;/span&gt; &lt;span class="n"&gt;checkout&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;//s3fs.googlecode.com/svn/trunk/ s3fs-read-only&lt;/span&gt;
&lt;span class="n"&gt;cd&lt;/span&gt; &lt;span class="n"&gt;s3fs&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;only&lt;/span&gt;
&lt;span class="n"&gt;autoreconf&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;install&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;configure&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;prefix&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;
&lt;span class="n"&gt;make&lt;/span&gt;
&lt;span class="n"&gt;make&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Разрешим доступ к s3 простым пользователям:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;user_allow_other&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;fuse&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;conf&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь создаём файл /etc/passwd-s3fs с содержанием по примеру:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;bucketName&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;accessKeyId&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;secretAccessKey&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После монтируем bucket:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;s3fs&lt;/span&gt; &lt;span class="n"&gt;backup&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;backups&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ouse_cache&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;//s3-website-eu-west-1.amazonaws.com&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;в "-o url" я указываю url своего бакета. Это значение нужно установить в
зависимости от расположения инстанса. Спаисбо!&lt;/p&gt;</summary><category term="s3fs"></category><category term="amazon"></category><category term="s3"></category><category term="ubuntu"></category></entry><entry><title>Пересоздание журнала файловой системы ext3,4</title><link href="http://yavorovych.com/peresozdanie-zhurnala-fajlovoj-sistemy-ext34.html" rel="alternate"></link><updated>2012-09-06T13:36:31+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-09-06:peresozdanie-zhurnala-fajlovoj-sistemy-ext34.html</id><summary type="html">&lt;p&gt;Нам потребуется выполнить всего лишь 1 команду. Прошу заметить, что ФС во
время этой операции должна быть отмонтирована:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;tune2fs&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;O&lt;/span&gt; &lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="n"&gt;has_journal&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;md3&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;/dev/md3 в данном случае - блочное устройство с нужной файловой системой.&lt;/p&gt;</summary><category term="journal"></category><category term="recreate"></category><category term="ext4"></category><category term="tune2fs"></category><category term="ext3"></category></entry><entry><title>Django - сигналы</title><link href="http://yavorovych.com/django-signaly.html" rel="alternate"></link><updated>2012-09-05T20:50:16+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-09-05:django-signaly.html</id><summary type="html">&lt;p&gt;Доброго времени суток, друзья! Сегодня я расскажу о очень крутой возможности
Django - сигналах. Сперва немного теории. Когда в Django происходит некоторое
событие (к примеру, в модель были записаны данные) Django генерирует signal
(на самом деле - несколько сигналов. Во время иницилизации, перед записью
данных, после записи и т.д.). Эти сигналы можно "ловить" и выполнять любые
действия. Давай разберём работу сигналов на примере. Итак, я установил django-
payment-webmoney (мерчант webmoney) для того, чтобы клиенты могли через
webmoney пополнять свой баланс. Моя задача - выполнять произвольный код после
того, как оплата была подтверждена. Я знаю, что когда оплата выполнения -
django-payment-webmoney фиксирует платёж в моделе Payment. Отлично, сигналы к
ней мы и будем фиксировать. Нас интересует сигнал post_save, и код в конечном
итоге будет выглядеть следующим образом:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="n"&gt;webmoney&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt; &lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Payment&lt;/span&gt;
&lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dispatch&lt;/span&gt; &lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;receiver&lt;/span&gt;
&lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="n"&gt;django&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;models&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;signals&lt;/span&gt; &lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;post_save&lt;/span&gt;

&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;receiver&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post_save&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sender&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Payment&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;def&lt;/span&gt; &lt;span class="n"&gt;webmoney_payment_accepted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sender&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="err"&gt;Функция&lt;/span&gt; &lt;span class="err"&gt;создания&lt;/span&gt; &lt;span class="err"&gt;транзакции&lt;/span&gt;
    &lt;span class="err"&gt;при&lt;/span&gt; &lt;span class="err"&gt;пополнении&lt;/span&gt; &lt;span class="n"&gt;webmoney&lt;/span&gt;
    &lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;payment&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="n"&gt;Transaction&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;balance&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;payment&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;invoice&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;transaction_type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;cost&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;payment&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;amount&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как видно из примера - мы "ловим" сигнал, определяем в payment созданный
объект и добавляем транзакцию в нашу модель (дальше эта транзакция похожим
сигналом инкрементирует баланс пльзователя). Вот и всё! Django, спасибо тебе
за твою простоту и доходчивость. Конечно же, по этому вопросу есть
замечательная
&lt;a href="https://docs.djangoproject.com/en/dev/ref/signals/"&gt;документация&lt;/a&gt; в
официальном руководстве.&lt;/p&gt;</summary><category term="signal"></category><category term="django"></category><category term="webmoney"></category></entry><entry><title>Zabbix external check - Websockets</title><link href="http://yavorovych.com/zabbix-external-check-websockets.html" rel="alternate"></link><updated>2012-09-03T17:13:12+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-09-03:zabbix-external-check-websockets.html</id><summary type="html">&lt;p&gt;Вэбсокеты всё глубже входят в нашу жизнь, они открывают занавес быстрому и
интерактивному web-у. И конечно же, их тоже нужно уметь мониторить. Сегодня я
расскажу простое решение для этого. Итак, я использую zabbix, по этому дам
пример решения для него. Сперва установим необходимые модули:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;pip&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;websocket&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;client&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь в /etc/zabbix/externalscripts/websocket_check.py поместим следующий
код:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
 &lt;span class="mi"&gt;2&lt;/span&gt;
 &lt;span class="mi"&gt;3&lt;/span&gt;
 &lt;span class="mi"&gt;4&lt;/span&gt;
 &lt;span class="mi"&gt;5&lt;/span&gt;
 &lt;span class="mi"&gt;6&lt;/span&gt;
 &lt;span class="mi"&gt;7&lt;/span&gt;
 &lt;span class="mi"&gt;8&lt;/span&gt;
 &lt;span class="mi"&gt;9&lt;/span&gt;
&lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;
&lt;span class="mi"&gt;12&lt;/span&gt;
&lt;span class="mi"&gt;13&lt;/span&gt;
&lt;span class="mi"&gt;14&lt;/span&gt;
&lt;span class="mi"&gt;15&lt;/span&gt;
&lt;span class="mi"&gt;16&lt;/span&gt;
&lt;span class="mi"&gt;17&lt;/span&gt;
&lt;span class="mi"&gt;18&lt;/span&gt;

&lt;span class="cp"&gt;#!/usr/bin/python&lt;/span&gt;
&lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;
&lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="n"&gt;websocket&lt;/span&gt; &lt;span class="n"&gt;import&lt;/span&gt; &lt;span class="n"&gt;create_connection&lt;/span&gt;

&lt;span class="n"&gt;websocket_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/app&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;port&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="nl"&gt;try:&lt;/span&gt;
        &lt;span class="n"&gt;ws&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;create_connection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ws://%s:%s%s&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;websocket_path&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;ws&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;recv&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;ping&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
        &lt;span class="nl"&gt;else:&lt;/span&gt;
                &lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
        &lt;span class="n"&gt;ws&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="nl"&gt;except:&lt;/span&gt;
        &lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Замените значение websocket_path на своё и добавьте скрипты права на
выполнение:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;chmod&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;zabbix&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;externalscripts&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;websocket_check&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Обратите внимание, что данный скрипт проверяет ответ от сервера (мой сервер
возвращает "ping", если всё хорошо). Это значение может отличаться. Теперь
добавьте новый Item типа [External check](http://www.zabbix.com/documentation/&lt;/p&gt;
&lt;p&gt;2.0/manual/config/items/itemtypes/external) с указанием порта web-сокета:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;websocket_check&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;80&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После Вы можете настроить тригер на своё усмотрение. Скрипт возвращает 1 в
случае успешной проверки и 0 в случае проблемы. Вот и всё, приятной работы!&lt;/p&gt;</summary><category term="websocket"></category><category term="python"></category><category term="monitoring"></category><category term="zabbix"></category></entry><entry><title>Unity: открытие копии приложения</title><link href="http://yavorovych.com/unity-otkrytie-kopii-prilozheniya.html" rel="alternate"></link><updated>2012-07-02T12:32:25+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-07-02:unity-otkrytie-kopii-prilozheniya.html</id><summary type="html">&lt;p&gt;Как оказалось - в Unity, что так пропагандируется Ubuntu открыть копию одного
и того же приложения 2 раза может составить проблему, т.к. панель с ярлыками
ПО одновременно является и панелью задач (увы, я пользуюсь терминологией
Windows, т.к. графическая среда максимально приблизилась к интерфейсу данной
ОС). Для открытия копии приложения просто нажмите на него колёсиком мышки :)&lt;/p&gt;</summary><category term="launcher"></category><category term="unity"></category><category term="ubuntu"></category></entry><entry><title>Установка Python-2.7 в virtualenv</title><link href="http://yavorovych.com/ustanovka-python-27-v-virtualenv.html" rel="alternate"></link><updated>2012-04-09T17:54:29+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-04-09:ustanovka-python-27-v-virtualenv.html</id><summary type="html">&lt;p&gt;Для того, чтобы установить Python версии 2.7 в виртуальном окружении с более
ранней версией интерпритатора нужно выполнить несколько несложных действий:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Посмотрим на список наших окружений&lt;/p&gt;
&lt;p&gt;$ lsvirtualenv
myevn
test2&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Перейдём в нужное окружение&lt;/p&gt;
&lt;p&gt;workon test2&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Создам каталог, где разместим исходниники Python-2.7 и перейдём в него:&lt;/p&gt;
&lt;p&gt;mkdir ~/.virtualenvs/test2/src/; cd mkdir ~/.virtualenvs/test2/src/&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Загрузим исходники python&lt;/p&gt;
&lt;p&gt;wget http://www.python.org/ftp/python/2.7/Python-2.7.tgz&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Распакуем их и перейдём в каталог с исходными текстами:&lt;/p&gt;
&lt;p&gt;tar xvvf Python-2.7.tgz; cd Python-2.7&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Конфигурируем Python&lt;/p&gt;
&lt;p&gt;./configure --prefix=$HOME/.virtualenvs/test2/&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Компиляция&lt;/p&gt;
&lt;p&gt;make&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Установка&lt;/p&gt;
&lt;p&gt;make install&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Загрузка скрипта установки setuptools&lt;/p&gt;
&lt;p&gt;wget http://peak.telecommunity.com/dist/ez_setup.py&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Устнановка инструментов установки&lt;/p&gt;
&lt;p&gt;python ez_setup.py&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Устанавливаем PIP&lt;/p&gt;
&lt;p&gt;easy_install pip&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Проверяем&lt;/p&gt;
&lt;p&gt;$ python -V
Python 2.7&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</summary><category term="python"></category><category term="virtualenv"></category></entry><entry><title>Puppet - список IP адресов сервера в template</title><link href="http://yavorovych.com/puppet-spisok-ip-adresov-servera-v-template.html" rel="alternate"></link><updated>2012-04-03T23:16:17+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-04-03:puppet-spisok-ip-adresov-servera-v-template.html</id><summary type="html">&lt;p&gt;Привет, друзья!&lt;/p&gt;
&lt;p&gt;Что такое системы автоматизации никому рассказывать, наверно, не нужно.&lt;/p&gt;
&lt;p&gt;Я для этих целей использую &lt;a href="http://puppetlabs.com/"&gt;Puppet&lt;/a&gt; (кстати, он с
недавих пор даже Windows менеджит!)&lt;/p&gt;
&lt;p&gt;Встала недавно передо мной задачка научить кукловода управлять конфигом
PowerDNS.&lt;/p&gt;
&lt;p&gt;Кажется - что может быть проще? Делаем модуль, или даже класс с пакетом,
сервисом, темплейтом и вуаля - всё работает.&lt;/p&gt;
&lt;p&gt;Но не тут то было. У серверов может быть несколько IP-адресов, и PowerDNS
должен уметь ответить по каждому из них. По этому мы должны это учесть и в
local-address указать список всех нужных IP.&lt;/p&gt;
&lt;p&gt;Мне не нужно было ограничивать какие то IP, и нужно было указывать всегда и
все. По этому задача оказалась проще, но не на много.&lt;/p&gt;
&lt;p&gt;Как получить список всех адресов сервера в шаблоне и вывести их, разделяя
пробелами?&lt;/p&gt;
&lt;p&gt;Мне помог Torbjörn Norinder (спасибо ему, т.к. я в руби не шарю), ответ
которого я нашёл в на страница обсуждения в &lt;a href="http://groups.google.com/group/puppet-users/msg/439facf1f5b87b7a"&gt;Google
Groups&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Выглядит шаблонный код так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;scope&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_hash&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;acc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;acc&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;=~&lt;/span&gt; &lt;span class="sr"&gt;/^ipaddress_/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;acc&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Готовый темлейт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;setuid=pdns&lt;/span&gt;
&lt;span class="x"&gt;setgid=pdns&lt;/span&gt;
&lt;span class="x"&gt;launch=gmysql&lt;/span&gt;
&lt;span class="x"&gt;master=no&lt;/span&gt;
&lt;span class="x"&gt;slave=yes&lt;/span&gt;
&lt;span class="x"&gt;gmysql-host=127.0.0.1&lt;/span&gt;
&lt;span class="x"&gt;gmysql-user=pdns&lt;/span&gt;
&lt;span class="x"&gt;gmysql-password=pass&lt;/span&gt;
&lt;span class="x"&gt;gmysql-dbname=powerdns&lt;/span&gt;
&lt;span class="x"&gt;disable-axfr=yes&lt;/span&gt;
&lt;span class="x"&gt;lazy-recursion=yes&lt;/span&gt;
&lt;span class="x"&gt;local-port=53&lt;/span&gt;
&lt;span class="x"&gt;version-string=powerdns&lt;/span&gt;
&lt;span class="x"&gt;local-address=&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="n"&gt;scope&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_hash&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;acc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;acc&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt; &lt;span class="o"&gt;=~&lt;/span&gt; &lt;span class="sr"&gt;/^ipaddress_/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;acc&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="puppet"></category><category term="powerdns"></category><category term="templates"></category></entry><entry><title>Хостинг для Django - тестирование</title><link href="http://yavorovych.com/hosting-dlya-django-testirovanie.html" rel="alternate"></link><updated>2012-04-02T05:10:33+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-04-02:hosting-dlya-django-testirovanie.html</id><summary type="html">&lt;p&gt;&lt;a href="http://hosting4django.net/"&gt;&lt;img alt="Hosting4Django logo" src="http://hosting4django.net/templates/h4d_template/img/logo-t.png" /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Вот уже виднеется финишная прямая разработки и стартовая линия запуска
&lt;a href="http://hosting4django.net/"&gt;Hosting4Django&lt;/a&gt;. :)&lt;/p&gt;
&lt;p&gt;Сейчас мы занимаемся тестирование узлов проекта, и т.к. мой блог тоже
использует одноимённый фреймвёрк я решил перенести его на новый хостинг так,
как если бы сам был клиентом.&lt;/p&gt;
&lt;p&gt;Всё прошло достаточно гладко, но всё же заставило внести мелкие изменения в
работу сервисов.&lt;/p&gt;
&lt;p&gt;Так же переезд привёл к появлению инструкций в KB:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://hosting4django.net/knowledgebase.php?action=displayarticle&amp;amp;id=1"&gt;Покупка хостинга. Первые шаги.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://hosting4django.net/knowledgebase.php?action=displayarticle&amp;amp;id=4"&gt;Создание Django-проекта&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Старт уже совсем скоро :)&lt;/p&gt;</summary><category term="django"></category><category term="testing"></category><category term="hosting4django"></category></entry><entry><title>RVM: Installing Ruby 1.9.3</title><link href="http://yavorovych.com/rvm-installing-ruby-193.html" rel="alternate"></link><updated>2012-03-15T17:08:34+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-03-15:rvm-installing-ruby-193.html</id><summary type="html">&lt;p&gt;Привет! Чтобы поставить ruby-1.9.3 в rvm просто выполняем:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;rvm&lt;/span&gt; &lt;span class="n"&gt;get&lt;/span&gt; &lt;span class="n"&gt;head&lt;/span&gt;
&lt;span class="n"&gt;rvm&lt;/span&gt; &lt;span class="n"&gt;reload&lt;/span&gt;
&lt;span class="n"&gt;rvm&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="mf"&gt;1.9.3&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;preview1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Проверяем:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;rvm&lt;/span&gt; &lt;span class="n"&gt;list&lt;/span&gt;

&lt;span class="n"&gt;rvm&lt;/span&gt; &lt;span class="n"&gt;rubies&lt;/span&gt;

&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;ruby&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.9.2&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p290&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="n"&gt;i686&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
   &lt;span class="n"&gt;ruby&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;1.9.3&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;preview1&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="n"&gt;i686&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для активации нового ruby делаем:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;rvm&lt;/span&gt; &lt;span class="n"&gt;use&lt;/span&gt; &lt;span class="mf"&gt;1.9.3&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary></entry><entry><title>Apache::Authn::Redmine, SVN commit: Can't chmod... Operation not permitted</title><link href="http://yavorovych.com/apacheauthnredmine-svn-commit-cant-chmod-operation.html" rel="alternate"></link><updated>2012-03-05T17:25:15+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-03-05:apacheauthnredmine-svn-commit-cant-chmod-operation.html</id><summary type="html">&lt;p&gt;Привет!&lt;/p&gt;
&lt;p&gt;Недавно столкнулся с одной проблемой в svn-репозитории, где авторизация
реализована с помощью Redmine (http://www.redmine.org/projects/redmine/wiki/Repositories_access_control_with_apache_mod_dav_svn_and_mod_perl).&lt;/p&gt;
&lt;p&gt;Проблема проявлялась не всегда, а при очень странных обстоятельствах - когда
делается commit большого количество файлов&lt;/p&gt;
&lt;p&gt;Что такое "много" точно сказать не могу. Постепенно увеличивая количество
файлов я смог воспроизвести проблему, когда их количество достигло 1329.&lt;/p&gt;
&lt;p&gt;В логе Apache (svn работает через mod_dav) видны следующие ошибки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;[Mon Mar 05 10:19:32 2012] [error] [client 195.88.124.162] Could not MERGE resource &amp;quot;/my-repo/!svn/act/db20c88f-8a7a-4e20-a689-cf47ee2897f1&amp;quot; into &amp;quot;/my-repo/trunk&amp;quot;.  [409, #0]&lt;/span&gt;
&lt;span class="k"&gt;[Mon Mar 05 10:19:32 2012] [error] [client 195.88.124.162] An error occurred while committing the transaction.  [409, #1]&lt;/span&gt;
&lt;span class="k"&gt;[Mon Mar 05 10:19:32 2012] [error] [client 195.88.124.162] Can&amp;#39;t chmod &amp;#39;/home/svn/my-repo/db/txn-protorevs/5-h.rev&amp;#39;: Operation not permitted  [409, #1]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;SVN-пользователь же получает при коммите следующую ошибку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;Can&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="n"&gt;chmod&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;svn&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;my&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;repo&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;db&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;txn&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;protorevs&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;9.&lt;/span&gt;&lt;span class="n"&gt;rev&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Operation&lt;/span&gt; &lt;span class="n"&gt;not&lt;/span&gt; &lt;span class="n"&gt;permitted&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как выяснилось - в подобных условиях MERGE resource производится не от
пользователя, от которого работает web-сервер и mod_dav, соответственно (до
этого я использовать mod-event), а пользователь, от которого работает Redmine.
Почему так происходит - я не могу сказать, т.к. код модуля
Apache::Authn::Redmine не рассматривал (да-да, нужно отписать баг-репорт
(найти бы время на детальное исследования вопроса для оформления эного)).&lt;/p&gt;
&lt;p&gt;В качестве достойного на мой взгляд work-around'а я рекомендую переход на MPM-
ITK.&lt;/p&gt;
&lt;p&gt;В CentOS сделать это очень просто:&lt;/p&gt;
&lt;p&gt;1) Ставим http://centos.alt.ru/ repo. 2) Обновляем Apache:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="n"&gt;update&lt;/span&gt; &lt;span class="n"&gt;httpd&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;3) Правим /etc/sysconfig/httpd&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;# ITK model&lt;/span&gt;
&lt;span class="n"&gt;HTTPD&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sbin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;httpd&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;itk&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;4) Правим /etc/httpd/conf.d/php.conf, добавляя:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;  &lt;span class="n"&gt;LoadModule&lt;/span&gt; &lt;span class="n"&gt;php5_module&lt;/span&gt; &lt;span class="n"&gt;modules&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;libphp5&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;so&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;5) Правим Virtual Host, который обслуживает SVN, добавляя в него строку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;AssignUserID&lt;/span&gt; &lt;span class="n"&gt;redmine&lt;/span&gt; &lt;span class="n"&gt;redmine&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;, где redmine - имя пользователя и группа, от которого работает Redmine.&lt;/p&gt;</summary></entry><entry><title>Про Firefox, Chrome, Thunderbird и Сlaws</title><link href="http://yavorovych.com/pro-firefox-chrome-thunderbird-i-slaws.html" rel="alternate"></link><updated>2012-03-03T17:23:43+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-03-03:pro-firefox-chrome-thunderbird-i-slaws.html</id><summary type="html">&lt;p&gt;Посетила сегодня меня&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="err"&gt;Мысль&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;что&lt;/span&gt; &lt;span class="n"&gt;Firefox&lt;/span&gt; &lt;span class="err"&gt;менять&lt;/span&gt; &lt;span class="err"&gt;пора&lt;/span&gt;
&lt;span class="err"&gt;И&lt;/span&gt; &lt;span class="n"&gt;Trhunderbird&lt;/span&gt; &lt;span class="err"&gt;уже&lt;/span&gt; &lt;span class="err"&gt;не&lt;/span&gt; &lt;span class="err"&gt;тот&lt;/span&gt;
&lt;span class="err"&gt;Ану&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="err"&gt;ка&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;гляну&lt;/span&gt; &lt;span class="err"&gt;ка&lt;/span&gt; &lt;span class="err"&gt;я&lt;/span&gt; &lt;span class="err"&gt;в&lt;/span&gt; &lt;span class="n"&gt;TOP&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;

&lt;span class="err"&gt;Смотрел&lt;/span&gt; &lt;span class="err"&gt;он&lt;/span&gt; &lt;span class="err"&gt;в&lt;/span&gt; &lt;span class="n"&gt;TOP&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;е&lt;/span&gt; &lt;span class="err"&gt;на&lt;/span&gt; &lt;span class="err"&gt;меня&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;
&lt;span class="err"&gt;Продукт&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Компании Добра&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="err"&gt;Скачал&lt;/span&gt; &lt;span class="err"&gt;я&lt;/span&gt; &lt;span class="err"&gt;этот&lt;/span&gt; &lt;span class="n"&gt;RPM&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="err"&gt;И&lt;/span&gt; &lt;span class="err"&gt;сделал&lt;/span&gt; &lt;span class="err"&gt;ему&lt;/span&gt; &lt;span class="n"&gt;rpm&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Uhv&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;package_name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="err"&gt;Зашёл&lt;/span&gt; &lt;span class="err"&gt;я&lt;/span&gt; &lt;span class="err"&gt;в&lt;/span&gt; &lt;span class="n"&gt;GNOM&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;овское&lt;/span&gt; &lt;span class="err"&gt;меню&lt;/span&gt;
&lt;span class="err"&gt;Открыл&lt;/span&gt; &lt;span class="err"&gt;я&lt;/span&gt; &lt;span class="err"&gt;браузер&lt;/span&gt; &lt;span class="err"&gt;на&lt;/span&gt; &lt;span class="err"&gt;всю&lt;/span&gt;
&lt;span class="err"&gt;Увидел&lt;/span&gt; &lt;span class="err"&gt;да&lt;/span&gt; &lt;span class="err"&gt;и&lt;/span&gt; &lt;span class="err"&gt;тут&lt;/span&gt; &lt;span class="err"&gt;же&lt;/span&gt; &lt;span class="err"&gt;обомлел&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;Сколько плагинов, и тем...&amp;quot;&lt;/span&gt;

&lt;span class="s"&gt;&amp;quot;Ну!&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="err"&gt;подумал&lt;/span&gt; &lt;span class="err"&gt;я&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;Да сколько же закладок у меня!&lt;/span&gt;
&lt;span class="err"&gt;Десятки&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;ов&lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="err"&gt;ещё&lt;/span&gt; &lt;span class="err"&gt;ключей&lt;/span&gt;
&lt;span class="err"&gt;Определённо&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt; &lt;span class="err"&gt;штук&lt;/span&gt; &lt;span class="err"&gt;ключей&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="err"&gt;Но&lt;/span&gt; &lt;span class="err"&gt;тут&lt;/span&gt; &lt;span class="err"&gt;открыв&lt;/span&gt; &lt;span class="err"&gt;меню&lt;/span&gt; &lt;span class="err"&gt;настроек&lt;/span&gt;
&lt;span class="err"&gt;как&lt;/span&gt; &lt;span class="err"&gt;молнией&lt;/span&gt; &lt;span class="err"&gt;пронзил&lt;/span&gt; &lt;span class="err"&gt;мой&lt;/span&gt; &lt;span class="err"&gt;взгляд&lt;/span&gt;
&lt;span class="err"&gt;Кошерный&lt;/span&gt; &lt;span class="err"&gt;способ&lt;/span&gt; &lt;span class="err"&gt;импортнуть&lt;/span&gt; &lt;span class="err"&gt;с&lt;/span&gt; &lt;span class="err"&gt;нуля&lt;/span&gt;
&lt;span class="err"&gt;Всю&lt;/span&gt; &lt;span class="err"&gt;базу&lt;/span&gt; &lt;span class="err"&gt;моего&lt;/span&gt; &lt;span class="n"&gt;firefox&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;освского&lt;/span&gt; &lt;span class="err"&gt;добра&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;

&lt;span class="err"&gt;Нажав&lt;/span&gt; &lt;span class="err"&gt;всего&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="err"&gt;кнопки&lt;/span&gt;
&lt;span class="err"&gt;И&lt;/span&gt; &lt;span class="err"&gt;не&lt;/span&gt; &lt;span class="err"&gt;успев&lt;/span&gt; &lt;span class="err"&gt;маргнуть&lt;/span&gt; &lt;span class="err"&gt;едва&lt;/span&gt;
&lt;span class="n"&gt;Bookmakers&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;ы&lt;/span&gt; &lt;span class="err"&gt;залились&lt;/span&gt; &lt;span class="err"&gt;скопом&lt;/span&gt;
&lt;span class="err"&gt;И&lt;/span&gt; &lt;span class="err"&gt;все&lt;/span&gt; &lt;span class="err"&gt;пароли&lt;/span&gt; &lt;span class="err"&gt;снова&lt;/span&gt; &lt;span class="err"&gt;у&lt;/span&gt; &lt;span class="err"&gt;меня&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;

&lt;span class="err"&gt;И&lt;/span&gt; &lt;span class="err"&gt;тут&lt;/span&gt; &lt;span class="err"&gt;я&lt;/span&gt; &lt;span class="err"&gt;начал&lt;/span&gt; &lt;span class="err"&gt;сёрфить&lt;/span&gt; &lt;span class="err"&gt;Интернет&lt;/span&gt;
&lt;span class="err"&gt;В&lt;/span&gt; &lt;span class="err"&gt;надежде&lt;/span&gt; &lt;span class="err"&gt;найти&lt;/span&gt; &lt;span class="err"&gt;ещё&lt;/span&gt; &lt;span class="err"&gt;один&lt;/span&gt; &lt;span class="err"&gt;букет&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="err"&gt;Такой&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;чтоб&lt;/span&gt; &lt;span class="err"&gt;никогда&lt;/span&gt; &lt;span class="err"&gt;не&lt;/span&gt; &lt;span class="err"&gt;тормозил&lt;/span&gt;
&lt;span class="err"&gt;И&lt;/span&gt; &lt;span class="err"&gt;почту&lt;/span&gt; &lt;span class="err"&gt;вовремя&lt;/span&gt; &lt;span class="err"&gt;мне&lt;/span&gt; &lt;span class="err"&gt;привозил&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;

&lt;span class="err"&gt;Увидел&lt;/span&gt; &lt;span class="err"&gt;я&lt;/span&gt; &lt;span class="err"&gt;с&lt;/span&gt; &lt;span class="err"&gt;десятка&lt;/span&gt; &lt;span class="err"&gt;два&lt;/span&gt;
&lt;span class="err"&gt;Клиентов&lt;/span&gt; &lt;span class="err"&gt;разных&lt;/span&gt; &lt;span class="err"&gt;для&lt;/span&gt; &lt;span class="err"&gt;добра&lt;/span&gt;
&lt;span class="err"&gt;Что&lt;/span&gt; &lt;span class="err"&gt;по&lt;/span&gt; &lt;span class="n"&gt;IMAP&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;у&lt;/span&gt; &lt;span class="err"&gt;ходит&lt;/span&gt; &lt;span class="err"&gt;у&lt;/span&gt; &lt;span class="err"&gt;меня&lt;/span&gt;
&lt;span class="err"&gt;И&lt;/span&gt; &lt;span class="err"&gt;шлёт&lt;/span&gt; &lt;span class="err"&gt;через&lt;/span&gt; &lt;span class="err"&gt;чрез&lt;/span&gt; &lt;span class="n"&gt;SMTPS&lt;/span&gt; &lt;span class="err"&gt;всегда&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;

&lt;span class="err"&gt;Увидел&lt;/span&gt; &lt;span class="err"&gt;я&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;что&lt;/span&gt; &lt;span class="err"&gt;есть&lt;/span&gt; &lt;span class="err"&gt;зверёк&lt;/span&gt;
&lt;span class="err"&gt;С&lt;/span&gt; &lt;span class="err"&gt;кем&lt;/span&gt; &lt;span class="err"&gt;поцарапаться&lt;/span&gt; &lt;span class="err"&gt;чуток&lt;/span&gt;
&lt;span class="err"&gt;Мне&lt;/span&gt; &lt;span class="err"&gt;захотелось&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;наперёд&lt;/span&gt;
&lt;span class="err"&gt;я&lt;/span&gt; &lt;span class="err"&gt;ввёл&lt;/span&gt; &lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="n"&gt;search&lt;/span&gt; &lt;span class="n"&gt;claws&lt;/span&gt; &lt;span class="err"&gt;и&lt;/span&gt; &lt;span class="err"&gt;вот&lt;/span&gt;

&lt;span class="err"&gt;Увидел&lt;/span&gt; &lt;span class="err"&gt;в&lt;/span&gt; &lt;span class="err"&gt;шеле&lt;/span&gt; &lt;span class="err"&gt;радость&lt;/span&gt; &lt;span class="err"&gt;ту&lt;/span&gt;
&lt;span class="err"&gt;Пакет&lt;/span&gt; &lt;span class="err"&gt;в&lt;/span&gt; &lt;span class="n"&gt;epel&lt;/span&gt; &lt;span class="err"&gt;засел&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;я&lt;/span&gt; &lt;span class="err"&gt;жму&lt;/span&gt;
&lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="err"&gt;флаг&lt;/span&gt; &lt;span class="n"&gt;yum&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;у&lt;/span&gt; &lt;span class="err"&gt;передаю&lt;/span&gt;
&lt;span class="err"&gt;и&lt;/span&gt; &lt;span class="err"&gt;тут&lt;/span&gt; &lt;span class="err"&gt;же&lt;/span&gt; &lt;span class="err"&gt;вижу&lt;/span&gt; &lt;span class="n"&gt;claws&lt;/span&gt; &lt;span class="err"&gt;в&lt;/span&gt; &lt;span class="err"&gt;меню&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;

&lt;span class="err"&gt;Своею&lt;/span&gt; &lt;span class="err"&gt;скоростью&lt;/span&gt; &lt;span class="err"&gt;индеец&lt;/span&gt; &lt;span class="err"&gt;поразил&lt;/span&gt;
&lt;span class="err"&gt;И&lt;/span&gt; &lt;span class="err"&gt;имя&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Острого Когтя&amp;quot;&lt;/span&gt; &lt;span class="err"&gt;тут&lt;/span&gt; &lt;span class="err"&gt;же&lt;/span&gt; &lt;span class="err"&gt;получил&lt;/span&gt;
&lt;span class="err"&gt;Учётки&lt;/span&gt; &lt;span class="err"&gt;мыла&lt;/span&gt; &lt;span class="err"&gt;подтянулись&lt;/span&gt; &lt;span class="err"&gt;враз&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="err"&gt;и&lt;/span&gt; &lt;span class="err"&gt;тема&lt;/span&gt; &lt;span class="n"&gt;Tango&lt;/span&gt; &lt;span class="err"&gt;моих&lt;/span&gt; &lt;span class="err"&gt;глаз&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;

&lt;span class="err"&gt;Как&lt;/span&gt; &lt;span class="err"&gt;только&lt;/span&gt; &lt;span class="err"&gt;всё&lt;/span&gt; &lt;span class="err"&gt;поставил&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="err"&gt;перестал&lt;/span&gt; &lt;span class="err"&gt;спешить&lt;/span&gt;
&lt;span class="err"&gt;Почувствовал&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;что&lt;/span&gt; &lt;span class="err"&gt;мой&lt;/span&gt; &lt;span class="err"&gt;компьютер&lt;/span&gt; &lt;span class="err"&gt;начал&lt;/span&gt; &lt;span class="err"&gt;жить&lt;/span&gt;
&lt;span class="err"&gt;и&lt;/span&gt; &lt;span class="n"&gt;Load&lt;/span&gt; &lt;span class="err"&gt;спал&lt;/span&gt; &lt;span class="err"&gt;почти&lt;/span&gt; &lt;span class="err"&gt;на&lt;/span&gt; &lt;span class="err"&gt;треть&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="err"&gt;И&lt;/span&gt; &lt;span class="err"&gt;память&lt;/span&gt; &lt;span class="err"&gt;стала&lt;/span&gt; &lt;span class="err"&gt;не&lt;/span&gt; &lt;span class="err"&gt;так&lt;/span&gt; &lt;span class="err"&gt;жиреть&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;

&lt;span class="err"&gt;Обрадовался&lt;/span&gt; &lt;span class="err"&gt;я&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;что&lt;/span&gt; &lt;span class="err"&gt;всё&lt;/span&gt; &lt;span class="err"&gt;будет&lt;/span&gt; &lt;span class="err"&gt;летать&lt;/span&gt;
&lt;span class="err"&gt;Но&lt;/span&gt; &lt;span class="err"&gt;тут&lt;/span&gt; &lt;span class="err"&gt;решил&lt;/span&gt; &lt;span class="err"&gt;полазит&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;поискать&lt;/span&gt;
&lt;span class="err"&gt;Какой&lt;/span&gt; &lt;span class="err"&gt;то&lt;/span&gt; &lt;span class="err"&gt;посторонний&lt;/span&gt; &lt;span class="err"&gt;квешен&lt;/span&gt;
&lt;span class="err"&gt;Совсем&lt;/span&gt; &lt;span class="err"&gt;не&lt;/span&gt; &lt;span class="err"&gt;в&lt;/span&gt; &lt;span class="err"&gt;теме&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;но&lt;/span&gt; &lt;span class="err"&gt;уже&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;повешан&amp;quot;&lt;/span&gt;

&lt;span class="err"&gt;И&lt;/span&gt; &lt;span class="err"&gt;как&lt;/span&gt; &lt;span class="err"&gt;же&lt;/span&gt; &lt;span class="err"&gt;непривычно&lt;/span&gt; &lt;span class="err"&gt;стало&lt;/span&gt; &lt;span class="err"&gt;вдруг&lt;/span&gt;
&lt;span class="err"&gt;И&lt;/span&gt; &lt;span class="err"&gt;вкладки&lt;/span&gt; &lt;span class="err"&gt;выглядят&lt;/span&gt; &lt;span class="err"&gt;совсем&lt;/span&gt; &lt;span class="err"&gt;иначе&lt;/span&gt;
&lt;span class="err"&gt;И&lt;/span&gt; &lt;span class="err"&gt;я&lt;/span&gt; &lt;span class="err"&gt;сказал&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;что&lt;/span&gt; &lt;span class="err"&gt;нужно&lt;/span&gt; &lt;span class="err"&gt;всё&lt;/span&gt; &lt;span class="err"&gt;исправить&lt;/span&gt;
&lt;span class="err"&gt;Не&lt;/span&gt; &lt;span class="err"&gt;тут&lt;/span&gt; &lt;span class="err"&gt;то&lt;/span&gt; &lt;span class="err"&gt;было&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="err"&gt;я&lt;/span&gt; &lt;span class="err"&gt;пошёл&lt;/span&gt; &lt;span class="err"&gt;спать&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary></entry><entry><title>Перенаправления всей исходящей почты на один E-mail в CentOS, используя Postfix и Dovecot.</title><link href="http://yavorovych.com/perenapravleniya-vse-ishodyashej-pochty-na-odin-e-.html" rel="alternate"></link><updated>2012-02-07T14:52:41+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-02-07:perenapravleniya-vse-ishodyashej-pochty-na-odin-e-.html</id><summary type="html">&lt;h3&gt;Задача&lt;/h3&gt;
&lt;p&gt;Задача стояла так:&lt;/p&gt;
&lt;p&gt;Есть development-сервер, на котором ведётся разработка различных web-
продуктов. Для тестов нужно собирать всю исходящую с сервера почту (sendmail,
php-mail, etc.) и складывать её в 1 месте, очищая этот склад раз в 10 дней.&lt;/p&gt;
&lt;h4&gt;Postfix - перенаправленные исходящих сообщений&lt;/h4&gt;
&lt;p&gt;Для начала поставим его:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;postfix&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для перенаправленный всех исходящей почты я использовал Postfix. Всё, что
потребуется - это указать в /etc/postfix/main.cf строку с указанием файла, что
содержит правила для провеки headers. Правило можно разместить в конце файла,
как и правило, что будет указывать способ хранения писем. Я предпочитаю
Maildir, что упростит работу над удалением старых писем.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;header_checks&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pcre&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;postfix&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;header_checks&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pcre&lt;/span&gt;
&lt;span class="n"&gt;home_mailbox&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Maildir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь заполняем сам /etc/postfix/header_checks.pcre&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="err"&gt;*/&lt;/span&gt; &lt;span class="n"&gt;REDIRECT&lt;/span&gt; &lt;span class="n"&gt;nullmail&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как видно из правила - мы ловим все сообщения (регексп "/.*/") и выполняем над
ними действие REDIRECT на nullmail@dev.server.&lt;/p&gt;
&lt;p&gt;nullmail@dev.server - это ящик, что будем распогать на этом же сервере, что
имеет hostname = "dev.server".&lt;/p&gt;
&lt;p&gt;В перспективе я планировал изолировать почтовые сервисы от внешнего Мира,
чтобы не допустить возможности отправить сообщения с dev-севера на реальный
адрес посредством локального почтового сервера. Но об этом позже.&lt;/p&gt;
&lt;p&gt;Для того, чтобы ловить письма сосздадим пользователя nullmail в системе,
который и будет хранить письма.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;useradd&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sbin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nologin&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;g&lt;/span&gt; &lt;span class="n"&gt;mail&lt;/span&gt; &lt;span class="n"&gt;nullmail&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Здаданим пароль пользователю. Его мы будем использовать при доступе к
почтовому ящику.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;passwd&lt;/span&gt; &lt;span class="n"&gt;nullmail&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь запускаем postfix и добавляем его в автозагрузку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;postfix&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;
&lt;span class="n"&gt;chkconfig&lt;/span&gt; &lt;span class="n"&gt;postfix&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Dovecot&lt;/h4&gt;
&lt;p&gt;В нашем случае достаточно стандартной настройки Dovecot и я не буду
акцентировать внимание на его тонкостях. В CentOS 6 из коробки с нужным нами
обязанностями он справляется на ура, так что просто поставим его и запустим.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;dovecot&lt;/span&gt;
&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;dovecot&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;
&lt;span class="n"&gt;chkconfig&lt;/span&gt; &lt;span class="n"&gt;dovecot&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Проверка&lt;/h3&gt;
&lt;p&gt;Теперь протестируем работу нашей системы:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;ifconfig&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;sendmail&lt;/span&gt; &lt;span class="n"&gt;none&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;example&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Таким образом мы отправили письмо на несуществующий ящик существующего (по
крайней мере, на момент создания поста) домена.&lt;/p&gt;
&lt;p&gt;Проверим, пришло ли письмо:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;telnet&lt;/span&gt; &lt;span class="n"&gt;localhost&lt;/span&gt; &lt;span class="mi"&gt;110&lt;/span&gt;
&lt;span class="n"&gt;Trying&lt;/span&gt; &lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="mf"&gt;1.&lt;/span&gt;&lt;span class="p"&gt;..&lt;/span&gt;
&lt;span class="n"&gt;Connected&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;localhost&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="n"&gt;Escape&lt;/span&gt; &lt;span class="n"&gt;character&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;OK&lt;/span&gt; &lt;span class="n"&gt;Dovecot&lt;/span&gt; &lt;span class="n"&gt;ready&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="n"&gt;nullmail&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;OK&lt;/span&gt;
&lt;span class="n"&gt;pass&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="err"&gt;введите&lt;/span&gt; &lt;span class="err"&gt;пароль&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;OK&lt;/span&gt; &lt;span class="n"&gt;Logged&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="n"&gt;stat&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;OK&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="mi"&gt;1907&lt;/span&gt;
&lt;span class="n"&gt;quit&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;OK&lt;/span&gt; &lt;span class="n"&gt;Logging&lt;/span&gt; &lt;span class="n"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="n"&gt;Connection&lt;/span&gt; &lt;span class="n"&gt;closed&lt;/span&gt; &lt;span class="n"&gt;by&lt;/span&gt; &lt;span class="n"&gt;foreign&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как видно из ответа - в ящике лежит письмо, что было перенаправлено на наш
локальный ящик.&lt;/p&gt;
&lt;p&gt;В логах этот момент так же фиксируется:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;Feb&lt;/span&gt;  &lt;span class="mi"&gt;7&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt; &lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="n"&gt;postfix&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;17481&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;B2A3D101430&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="o"&gt;=&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;nullmail&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;orig_to&lt;/span&gt;&lt;span class="o"&gt;=&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;example&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;relay&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;delays&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.2&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;0.03&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;0.07&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dsn&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;2.0.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;sent&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;delivered&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;maildir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Отлично - всё работает.&lt;/p&gt;
&lt;h3&gt;Ipatbles&lt;/h3&gt;
&lt;p&gt;Теперь закроем доступ к локальному smtp-/pop3-/imap-серверам и smtp-ящикам в
Мире:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;N&lt;/span&gt; &lt;span class="n"&gt;MAIL&lt;/span&gt;
&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;INPUT&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="n"&gt;tcp&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;multiport&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;dports&lt;/span&gt; &lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;587&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;110&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;143&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;993&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;995&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="n"&gt;MAIL&lt;/span&gt; 
&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;OUTPUT&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="n"&gt;tcp&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;multiport&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;dports&lt;/span&gt; &lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;587&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;110&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;143&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;993&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;995&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="n"&gt;MAIL&lt;/span&gt; 
&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;MAIL&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="mf"&gt;127.0.0.1&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="n"&gt;ACCEPT&lt;/span&gt; 
&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;MAIL&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="mf"&gt;127.0.0.1&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="n"&gt;ACCEPT&lt;/span&gt; 
&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;MAIL&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="n"&gt;DROP&lt;/span&gt;
&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;ipatbles&lt;/span&gt; &lt;span class="n"&gt;save&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если iptables нет в автозагрузке - добавим его&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;chkconfig&lt;/span&gt; &lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Автоматическая очистка старых сообщений&lt;/h3&gt;
&lt;p&gt;Для этих целей мы напишем скрипт в 1 строчку и поместим его, скажем, в
/usr/local/bin/clean_old_email_messages.sh:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="mi"&gt;2&lt;/span&gt;

&lt;span class="cp"&gt;#!/bin/bash&lt;/span&gt;
&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nullmail&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Maildir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nullmail&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Maildir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cur&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;newermt&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt; &lt;span class="n"&gt;day&lt;/span&gt; &lt;span class="n"&gt;ago&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;exec&lt;/span&gt; &lt;span class="n"&gt;rm&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt; &lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И дадим ему права на выполнение:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;chmod&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;clean_old_email_messages&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь добавим его в /etc/contab:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="mo"&gt;00&lt;/span&gt; &lt;span class="mo"&gt;00&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;     &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;clean_old_email_messages&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Таким образом каждую полночь скрипт будет очищать сообщения, старше 10 дней.&lt;/p&gt;
&lt;h3&gt;В виде заключения&lt;/h3&gt;
&lt;p&gt;Так же для удобства доступа к почте можно поставить Web-клиент электронной
почты, такой, как &lt;a href="http://roundcube.net/"&gt;Roundcube&lt;/a&gt;, скажем.&lt;/p&gt;</summary></entry><entry><title>Бинарный счётчик на Arduino</title><link href="http://yavorovych.com/binarnyj-schyotchik-na-arduino.html" rel="alternate"></link><updated>2012-02-05T00:40:21+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-02-05:binarnyj-schyotchik-na-arduino.html</id><summary type="html">&lt;p&gt;Воскресным вечером ко мне пожаловал мой хороший друг. Я показал ему недавно
приобретённую Arduino Mega. Всё, что у нас было - IDE шлейф, несколько метров
витой пары и светодиоды.&lt;/p&gt;
&lt;p&gt;Вот то, что из этого получилось:&lt;/p&gt;
&lt;p&gt;А вот код, что был реализован:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cm"&gt;/*&lt;/span&gt;
&lt;span class="cm"&gt;Бинарный счётчик от 0 до 127&lt;/span&gt;
&lt;span class="cm"&gt;*/&lt;/span&gt;

&lt;span class="k"&gt;int&lt;/span&gt; &lt;span class="n"&gt;start_pin&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// Начальный PIN&lt;/span&gt;
&lt;span class="k"&gt;int&lt;/span&gt; &lt;span class="n"&gt;stop_pin&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mh"&gt;8&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// Конечный PIN&lt;/span&gt;

&lt;span class="k"&gt;int&lt;/span&gt; &lt;span class="n"&gt;leds&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;7&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;       &lt;span class="c1"&gt;// Массив &amp;quot;LED&amp;quot;-дисплея 7 x 1&lt;/span&gt;

&lt;span class="k"&gt;int&lt;/span&gt; &lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;           &lt;span class="c1"&gt;// Временная переменная&lt;/span&gt;

&lt;span class="k"&gt;void&lt;/span&gt; &lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Установка режимов PIN&amp;#39;ов для &amp;quot;LED&amp;quot;-дисплея  &lt;/span&gt;
  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;start_pin&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="n"&gt;stop_pin&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;pinMode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;OUTPUT&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;void&lt;/span&gt; &lt;span class="n"&gt;loop&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
 &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;int&lt;/span&gt; &lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mh"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;count&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="mh"&gt;127&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
   &lt;span class="n"&gt;bin&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mh"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mh"&gt;7&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
     &lt;span class="n"&gt;leds&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bin&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mh"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
     &lt;span class="n"&gt;bin&lt;/span&gt; &lt;span class="o"&gt;/=&lt;/span&gt; &lt;span class="mh"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
   &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mh"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mh"&gt;7&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
     &lt;span class="n"&gt;analogWrite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;start_pin&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mh"&gt;102&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;leds&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
   &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="n"&gt;delay&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;500&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
 &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary></entry><entry><title>Быстрая настройка NFS-сервера и клиента в CentOS Linux</title><link href="http://yavorovych.com/bystraya-nastrojka-nfs-servera-i-klienta-v-centos-.html" rel="alternate"></link><updated>2012-01-15T16:29:35+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-01-15:bystraya-nastrojka-nfs-servera-i-klienta-v-centos-.html</id><summary type="html">&lt;p&gt;Здравствуйте!&lt;/p&gt;
&lt;p&gt;Сегодня я расскажу как быстро настроить сервер и клиент для передачи данных по
замечательному протоколу NFS (Network File System).&lt;/p&gt;
&lt;h4&gt;Настройка NFS-сервера&lt;/h4&gt;
&lt;p&gt;В CentOS 6 minimal всё необходимое для работы уже есть, но если nfs-utils
среди пакетов Вы не находите, его можно установить:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;nfs&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;utils&lt;/span&gt; &lt;span class="n"&gt;nfs&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;utils&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;lib&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Каталоги, доступ к которым мы открываем настраиваются в конфиге /etc/exports&lt;/p&gt;
&lt;p&gt;Вот пример его содержания:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;share&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;           &lt;span class="mf"&gt;192.168.0.100&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rw&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;no_root_squash&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;no_subtree_check&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В данном примере мы открываем каталог /share/ и всего его содержимое в полный
доступ только для клиента с IP 192.168.0.100.&lt;/p&gt;
&lt;p&gt;Запускаем необходимые сервисы и добавляем их в автозапуск:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;rpcbind&lt;/span&gt; &lt;span class="n"&gt;restart&lt;/span&gt;
&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;nfs&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;
&lt;span class="n"&gt;chkconfig&lt;/span&gt; &lt;span class="n"&gt;rpcbind&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;
&lt;span class="n"&gt;chkconfig&lt;/span&gt; &lt;span class="n"&gt;nfs&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Не забываем разрешить в Firewall доступ к NFS-серверу:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;RH&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Firewall&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;INPUT&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="mf"&gt;192.168.0.100&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;state&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;state&lt;/span&gt; &lt;span class="n"&gt;NEW&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="n"&gt;tcp&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;dport&lt;/span&gt; &lt;span class="mi"&gt;2049&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="n"&gt;ACCEPT&lt;/span&gt;
&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="n"&gt;save&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Настройка&lt;/h3&gt;
&lt;p&gt;NFS-клиента&lt;/p&gt;
&lt;p&gt;На стороне клиента так же должна быть поддержка NFS в ядре. В случае с CentOS
5 и выше и стандартным ядром такая поддержка имеется.&lt;/p&gt;
&lt;p&gt;Правим /etc/fstab, указывая адрес удалённого сервера, расшареный каталог и
каталог для монтирования:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="mf"&gt;192.168.0.1&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="n"&gt;share&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;mnt&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;share&lt;/span&gt;      &lt;span class="n"&gt;nfs&lt;/span&gt;     &lt;span class="n"&gt;defaults&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;  &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В данном случае мы монтируем /share/ с сервера с IP 192.168.0.1 в /mnt/share.
В опциях монтирования мы указываем, что в каталогу могут иметь доступ обычные
пользователи. Так же каталог будет монтироваться автоматически при загрузке
системы.&lt;/p&gt;
&lt;p&gt;Выполняем монтирование руками:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;mount&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;mnt&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;share&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если никаких ошибок не увидели - значит всё прошло, как нужно. Если же есть -
смотрите /var/log/messages на обоих серверах на предмет ошибок от nfs, хотя
mount, как правило, достаточно информативно отвечает в случае, если есть
проблемы.&lt;/p&gt;</summary></entry><entry><title>Создание бекапов баз даных MySQL в Bacula</title><link href="http://yavorovych.com/sozdanie-bekapov-baz-danyh-mysql-v-bacula.html" rel="alternate"></link><updated>2012-01-14T18:40:19+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-01-14:sozdanie-bekapov-baz-danyh-mysql-v-bacula.html</id><summary type="html">&lt;p&gt;Доброго времени, друзья.&lt;/p&gt;
&lt;p&gt;Недавно я &lt;a href="/blog/2012/ustanovka-sistemy-rezervnogo-kopirovaniya-bacula-n/"&gt;написал статью о установка продвинутой системы резервного Bacula на
CentOS 6&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Bacula - отличная система, но в список её возможностей не входит создание
дампов баз данных MySQL.&lt;/p&gt;
&lt;p&gt;Так что сегодня я освещу этот вопрос.&lt;/p&gt;
&lt;p&gt;Начнём мы с написания скрипта, что будет создавать дампы баз данных MySQL. Не
забудьте указать нужные базы данных в $DBS_LIST.&lt;/p&gt;
&lt;h4&gt;Универсальный скрипт создания дампов баз данных MySQL:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
 &lt;span class="mi"&gt;2&lt;/span&gt;
 &lt;span class="mi"&gt;3&lt;/span&gt;
 &lt;span class="mi"&gt;4&lt;/span&gt;
 &lt;span class="mi"&gt;5&lt;/span&gt;
 &lt;span class="mi"&gt;6&lt;/span&gt;
 &lt;span class="mi"&gt;7&lt;/span&gt;
 &lt;span class="mi"&gt;8&lt;/span&gt;
 &lt;span class="mi"&gt;9&lt;/span&gt;
&lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;
&lt;span class="mi"&gt;12&lt;/span&gt;
&lt;span class="mi"&gt;13&lt;/span&gt;
&lt;span class="mi"&gt;14&lt;/span&gt;
&lt;span class="mi"&gt;15&lt;/span&gt;
&lt;span class="mi"&gt;16&lt;/span&gt;
&lt;span class="mi"&gt;17&lt;/span&gt;

&lt;span class="cp"&gt;#!/bin/bash&lt;/span&gt;
&lt;span class="n"&gt;DBS_LIST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;database1 database2 databaseN&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;MYSQLDUMP&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/usr/bin/mysqldump&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;MYSQLDUMP_OPTS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;-a&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;MYSQL_HOST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;localhost&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;MYSQL_USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;root&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;MYSQL_PASS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;SUPERPASS&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;BACKUP_DIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/backups/mysql&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;db_name&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;DBS_LIST&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;dump_file_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;$BACKUP_DIR/$db_name.sql&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;* Create dump for database &amp;#39;$db_name&amp;#39; to &amp;#39;$dump_file_path&amp;#39;...&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;MYSQLDUMP&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;MYSQL_HOST&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;MYSQL_USER&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;MYSQL_PASS&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;MYSQLDUMP_OPTS&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;db_name&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;dump_file_path&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;then&lt;/span&gt;
                &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;[DONE]&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;
                &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;[ERROR]&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="n"&gt;fi&lt;/span&gt;
&lt;span class="n"&gt;done&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Данный скрипт размещаем в /usr/local/bin/dbbackup.sh, к примеру, и даём ему
права на выполнение:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;chmod&lt;/span&gt; &lt;span class="mi"&gt;755&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;local&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dbbackup&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Настройка Bacula Director&lt;/h4&gt;
&lt;p&gt;Теперь пришло время настроить Директора на бекап дампов баз данных. Идея
такова - при запуске Bacula Job Bacula Client (File Server) запускает скрипт
создания дампов баз данных и складывает созданные дампы в /backups/mysql.
После Bacula резервирует указанные в настройках Director каталоги, а вместе с
ним /backups/mysql.&lt;/p&gt;
&lt;p&gt;Таким образом у нас всегда будет актуальные дампы баз данных в бекапах Bacula.&lt;/p&gt;
&lt;p&gt;Итак, идём на сервер, где установлена Bacula Director и правим конфиг
/etc/bacula/bacula-dir.conf. Поправить нам будет нужно только с секции Job и
FileSet.&lt;/p&gt;
&lt;p&gt;В секцию Job добавляем RunBeforeJob&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;Job&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt;          &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;BackupMyServer&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;JobDefs&lt;/span&gt;      &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;DefaultJob&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Client&lt;/span&gt;          &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;myserver&lt;/span&gt;
  &lt;span class="n"&gt;FileSet&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;myserver&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;ClientRunBeforeJob&lt;/span&gt;  &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/usr/local/bin/dbbackup.sh&amp;quot;&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;Перед&lt;/span&gt; &lt;span class="err"&gt;заливкой&lt;/span&gt; &lt;span class="err"&gt;запустить&lt;/span&gt; &lt;span class="err"&gt;наш&lt;/span&gt; &lt;span class="err"&gt;скрипт&lt;/span&gt; &lt;span class="err"&gt;для&lt;/span&gt; &lt;span class="err"&gt;создания&lt;/span&gt; &lt;span class="err"&gt;дампов&lt;/span&gt; &lt;span class="n"&gt;MySQL&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В секцию FileSet добавляем каталог, где наш скрипт складывает дампы:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;FileSet&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;myserver&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Include&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;Options&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;signature&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MD5&lt;/span&gt; &lt;span class="err"&gt;#Для&lt;/span&gt; &lt;span class="err"&gt;сверки&lt;/span&gt; &lt;span class="err"&gt;используем&lt;/span&gt; &lt;span class="n"&gt;MD5&lt;/span&gt;
      &lt;span class="n"&gt;Compression&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GZIP&lt;/span&gt; &lt;span class="err"&gt;#Используем&lt;/span&gt; &lt;span class="n"&gt;GZIP&lt;/span&gt; &lt;span class="err"&gt;компрессию&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;backups&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
    &lt;span class="n"&gt;FIle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;backups&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;Каталог&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="err"&gt;где&lt;/span&gt; &lt;span class="err"&gt;лежат&lt;/span&gt; &lt;span class="err"&gt;дампы&lt;/span&gt; &lt;span class="err"&gt;баз&lt;/span&gt; &lt;span class="n"&gt;MySQL&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Выполняем мягкую перезагрузку сервиса Bacula Director для принятия изменений:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt; &lt;span class="n"&gt;reload&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Вот так просто можно делать бекапы баз данных при использовании Bacula!&lt;/p&gt;</summary></entry><entry><title>Ограничение доступа к SSH по IP</title><link href="http://yavorovych.com/ogranichenie-dostupa-k-ssh-po-ip.html" rel="alternate"></link><updated>2012-01-07T16:47:26+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-01-07:ogranichenie-dostupa-k-ssh-po-ip.html</id><summary type="html">&lt;p&gt;Здравствуйте!&lt;/p&gt;
&lt;p&gt;Краткий копипаст, как закрыть доступ к порту SSH всем, кроме определённых
адресов.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;N&lt;/span&gt; &lt;span class="n"&gt;ALLOWED&lt;/span&gt;
&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;INPUT&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="n"&gt;ALLOWED&lt;/span&gt;
&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;ALLOWED&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="mf"&gt;95.211.115.248&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="n"&gt;ACCEPT&lt;/span&gt;
&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;INPUT&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="n"&gt;tcp&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;dport&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="n"&gt;DROP&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Описание действий:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;iptables -N ALLOWED - создаём свою цепочку в правилах iptables с иметем "ALLOWED".&lt;/li&gt;
&lt;li&gt;iptables -A INPUT -j ALLOWED - Добавляем в цепочку INPUT действие ALLOWED. Это даёт возможность настраивать свои правила для INPUT в кастомной цепочке ALLOWED.&lt;/li&gt;
&lt;li&gt;iptables -A ALLOWED -s 95.211.115.248 -j ACCEPT - разрешаем доступ для IP 95.211.115.248 ко всему, что только можно в нашей цепочке ALLOWED.&lt;/li&gt;
&lt;li&gt;iptables -A INPUT -p tcp --dport 22 -j DROP - блокируем доступ к 22 порту всем. (т.к. правило с действием ALLOWED было заявлено раньше, наши правила с открытием доступа будут работать).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Если Вы используете RHEL/CentOS можно сохранить правила таким образом:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="n"&gt;save&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для того, чтобы добавить новый IP в вайтлист, можно использовать команду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;ALLOWED&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;new_ip&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="n"&gt;ACCEPT&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для того, чтобы удалить IP из вайтлиста можно сделать так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;iptables&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;D&lt;/span&gt; &lt;span class="n"&gt;ALLOWED&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;ip&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt; &lt;span class="n"&gt;ACCEPT&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После не забываем сохранить правила в системном конфиге (для rpm-base это по
прежнему "servise iptables save")&lt;/p&gt;</summary></entry><entry><title>MySQL slow log</title><link href="http://yavorovych.com/mysql-slow-log.html" rel="alternate"></link><updated>2012-01-03T19:35:49+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-01-03:mysql-slow-log.html</id><summary type="html">&lt;p&gt;Для логгирования "долгих" запросов MySQL можно включить в секцию [mysqld]
конфигурации MySQL (для RHEL/CentOS это &lt;em&gt;/etc/my.cnf&lt;/em&gt;) следующие параметры&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;# Slow query log&lt;/span&gt;
&lt;span class="n"&gt;long_query_time&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;slow&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;queries&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;slow_queries&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;long_query_time - значение в секундах, после которого запрос нужно считать "долгим" и записывать информацию о нём в log-файл&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;log-slow-queries - path к log-файлу MySQL, где будут фиксироваться запросы, что выполнялись дольше, чем это описано в &lt;em&gt;long_query_time&lt;/em&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary></entry><entry><title>Установка системы резервного копирования Bacula 5.0 на CentOS 6</title><link href="http://yavorovych.com/ustanovka-sistemy-rezervnogo-kopirovaniya-bacula-n.html" rel="alternate"></link><updated>2012-01-03T18:22:11+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-01-03:ustanovka-sistemy-rezervnogo-kopirovaniya-bacula-n.html</id><summary type="html">&lt;p&gt;Всем доброго времени суток!&lt;/p&gt;
&lt;p&gt;Сегодня я расскажу о продвинутой системе для создания резервных копий -
&lt;a href="http://www.bacula.org/"&gt;Bacula&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Это статья призвана донести общую информацию о работе Bacula на примере её
установки на CentOS 6. В Base-репозитории CentOS 6 на данный момент вирсия
продукта 5.0. На её примере и будет построена документация.&lt;/p&gt;
&lt;p&gt;Статья сама по себе может оказаться полезной, но прежде, чем ринуться
применять полученные знания на в production-решениях я настоятельно советую
ознакомится с &lt;a href="http://www.bacula.org/en/?page=documentation"&gt;официальной
документацией&lt;/a&gt; и ответить себе
на несколько вопросов:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Я использую rsync/tar/самописные скрипты - зачем мне что то ещё?&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;В таком случае Вам, скорее всего, не нужна Bacula. Эта система рассчитана на
более масштабные задачи, чем бекап одного-двух серверов. Она позволяет
организовывать централизированную распределённую систему бекепов практически
чего угодно и куда угодно, включая возможность записи dvd-диски и магнитную
ленту стримера.&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Сейчас я произвожу бекап данных по протоколам, что поддерживаются многими ОС (таких как ftp или samba). Смогу ли я делать что то подобное с Bacula?&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;Bacula не поддерживает сторонние протоколы передачи данных, а использует
свой. Но это давольно кросплатформенный продукт. Так что Вы сможете
производить бекапы даже компьютеров с Windows.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Итак, немного теории.&lt;/p&gt;
&lt;h2&gt;Теория&lt;/h2&gt;
&lt;p&gt;Bacula состоит из нескольких независимых компонентов: Director, Console, File,
Storage и сервисы мониторинга.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Структура Bacula" src="/blog/2012/ustanovka-sistemy-rezervnogo-kopirovaniya-" /&gt;&lt;/p&gt;
&lt;h3&gt;Bacula Director&lt;/h3&gt;
&lt;p&gt;Bacula Director выполняет функции "директора" над всеми остальными сервисами -
запускает создание резервных копий и операции восстановление из бекапов,
управляет сервисами хранения данных (&lt;strong&gt;&lt;em&gt;Bacula Storage&lt;/em&gt;&lt;/strong&gt;), отсылке
уведомлений и т.д.&lt;/p&gt;
&lt;h3&gt;Bacula Console&lt;/h3&gt;
&lt;p&gt;Bacula Console служит для управления Bacula Director. Она имеет 3 версии
интерфейса: _ CLI _ QT-based * wxWidgets CLI лично меня всем устраивает, но
GUI у Bacula так же не уступают возможностями, что не может не радовать.&lt;/p&gt;
&lt;h3&gt;Bacula File&lt;/h3&gt;
&lt;p&gt;Bacula File (так же известна, как Клиентская часть) - это сервис, что
устанавливается на узлы, данные которого нужно резервировать. Существуют
версии для разных ОС. Все файлы доступны на &lt;a href="http://sourceforge.net/projects/bacula/files/#files"&gt;странице
sourceforge&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Bacula Storage&lt;/h3&gt;
&lt;p&gt;Bacula Storage - это сервис, основной целью которого есть управление хранением
данных с резервными копиями. Другими словами Bacula Storage используется
Bacula Director для чтения / записи данных с клентских машин, информация
которых резервируется.&lt;/p&gt;
&lt;h3&gt;Catalog&lt;/h3&gt;
&lt;p&gt;Catalog используется для хранения данных о бекепах, файлах, хранилищах и
всего, с чем работает Bacula Director. Catalog может использовать для хранения
данных различные БД, среди которых MySQL, PostgreSQL и SQLite.&lt;/p&gt;
&lt;h3&gt;Bacula Monitor&lt;/h3&gt;
&lt;p&gt;Bacula Monitor - это приложение, по даёт ифнормацию о состоянии Bacula
Director и его задачах. Это могут быть состояния тех или иных задач
(создание/восстановление резервных копий), доступность сервисов Bacula и т.д.
Существует несколько вариаций Bacula Monitor - все из них используют GTK+ и
работают как в KDE, GNOME так и других рабочих окружениях.&lt;/p&gt;
&lt;h2&gt;Установка&lt;/h2&gt;
&lt;h3&gt;SELinux disable&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;sed&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;s/SELINUX=.*/SELINUX=disabled/g&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sysconfig&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;selinux&lt;/span&gt;
&lt;span class="n"&gt;setenforce&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;MySQL Server&lt;/h3&gt;
&lt;p&gt;Мы будем использовать БД MySQL для хранения данных Bacula.&lt;/p&gt;
&lt;p&gt;Выполняем установку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;devel&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Запускаем MySQL-server и добавляем его init-скрипт в автозагрузку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;mysqld&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;
&lt;span class="n"&gt;chkconfig&lt;/span&gt; &lt;span class="n"&gt;mysqld&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Генерируем пароль для root-пользователя MySQL, устанавливаем его и добавляем в
/root/.my.cnf, чтобы будучи в shell от root иметь беспарольный доступ в MySQL
Shell от имени суперпользователя.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;MATRIX=&amp;quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&amp;quot;
LENGTH=&amp;quot;10&amp;quot;
while [ &amp;quot;&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;&amp;quot; -le &amp;quot;&lt;span class="nv"&gt;$LENGTH&lt;/span&gt;&amp;quot; ]; do PASS=&amp;quot;&lt;span class="nv"&gt;$PASS&lt;/span&gt;&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;MATRIX&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;RANDOM&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="c"&gt;#MATRIX&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;)):1}&amp;quot;; let n+=1; done
echo -e &amp;quot;[client]
user=root
password=&lt;span class="nv"&gt;$PASS&lt;/span&gt;&amp;quot; &amp;gt; /root/.my.cnf
/usr/bin/mysqladmin -u root password &lt;span class="nv"&gt;$PASS&lt;/span&gt;
PASS=&amp;quot;&amp;quot;
n=&amp;quot;&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Bacula services&lt;/h3&gt;
&lt;p&gt;В нашем примере будет использовано 2 физических сервера. На первом будут
установлены Director, File, Storage и Catalog (для бекапа данного сервера,
хранения данных и управления всеми сервисами), а на втором будет расположен
исключительно Bacula Client для создания бекапов данных на 2 сервере.&lt;/p&gt;
&lt;h4&gt;Server 2: Bacula Client&lt;/h4&gt;
&lt;p&gt;Как это ни странно - мы начнём настройку с второго сервера, клиентского. Я
посчитал, что настраивать доступы к клиентской части и после указывать их в
основном конфиге директора проще, чем делать это в обратной
последовательности.&lt;/p&gt;
&lt;p&gt;Устанавливаем клиентскую часть на сервер, что будем бекапить.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;client&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Правим конфиг &lt;strong&gt;/etc/bacula/bacula-fd.conf&lt;/strong&gt; указывая пароли доступа к Bacula
Client (Поля Password) для Директора и tray-monitor.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;Director&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt;
  &lt;span class="n"&gt;Password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;DIRBASSWORD&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Director&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mon&lt;/span&gt;
  &lt;span class="n"&gt;Password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;MOPASSWORD&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Monitor&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;yes&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;FileDaemon&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;                          &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;this&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;me&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;fd&lt;/span&gt;
  &lt;span class="n"&gt;FDport&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;9102&lt;/span&gt;                  &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;where&lt;/span&gt; &lt;span class="n"&gt;we&lt;/span&gt; &lt;span class="n"&gt;listen&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;director&lt;/span&gt;
  &lt;span class="n"&gt;WorkingDirectory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;spool&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bacula&lt;/span&gt;
  &lt;span class="n"&gt;Pid&lt;/span&gt; &lt;span class="n"&gt;Directory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;
  &lt;span class="n"&gt;Maximum&lt;/span&gt; &lt;span class="n"&gt;Concurrent&lt;/span&gt; &lt;span class="n"&gt;Jobs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;20&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Messages&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Standard&lt;/span&gt;
  &lt;span class="n"&gt;director&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;skipped&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;restored&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Запускаем сервис и добавляем его в автозагрузку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;fd&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;
&lt;span class="n"&gt;chkconfig&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;fd&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;strong&gt;&lt;em&gt;Во время настройки у меня небыло выделенного домена, который бы резолвился на всех используемых серверах для bacula-sd, и я наткнулся на проблему, когда бекап не мог запуститься, ругаясь следующим образом:&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Bad response to Storage command: wanted 2000 OK storage&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Как оказалось - Bacula Client обращается к Bacula Storage напрямую и т.к. я
указывал fqdn в конфигурации bacula-dir, который не резолвился, но был на
сервере Bacula Director, а на сервере, где расположен Bacula Client в host
соответствующей записи небыло, клиент и не мог подключится.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Решение&lt;/strong&gt;: все сервера в системе Bacula должны иметь доступ к доменам, что указаны в конфигурационных файлах.&lt;/p&gt;
&lt;h4&gt;Server 1: Bacula Director, Catalog, Storage&lt;/h4&gt;
&lt;p&gt;Теперь переходим к основной части - настройке Директора (Director), что хранит
данные в MySQL (посредством Catalog) и сервиса хранения данных бекапов
(Storage).&lt;/p&gt;
&lt;h5&gt;Установка пакетов через YAM&lt;/h5&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mysql&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;director&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mysql&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;console&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h5&gt;Настройка базы и пользователя MySQL для работы с Bacula&lt;/h5&gt;
&lt;p&gt;Теперь создадим MySQL-пользователя, базу данных и расставим нужные привилегии.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;libexec&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;grant_mysql_privileges&lt;/span&gt;
&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;libexec&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;create_mysql_database&lt;/span&gt;
&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;libexec&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;make_mysql_tables&lt;/span&gt;
&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;libexec&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;grant_bacula_privileges&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Сгенерируем пароль для MySQL-пользователя bacula и установим его.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;MATRIX=&amp;quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&amp;quot;
LENGTH=&amp;quot;10&amp;quot;
while [ &amp;quot;&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;&amp;quot; -le &amp;quot;&lt;span class="nv"&gt;$LENGTH&lt;/span&gt;&amp;quot; ]; do PASS=&amp;quot;&lt;span class="nv"&gt;$PASS&lt;/span&gt;&lt;span class="cp"&gt;${&lt;/span&gt;&lt;span class="n"&gt;MATRIX&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;RANDOM&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="c"&gt;#MATRIX&lt;/span&gt;&lt;span class="cp"&gt;}&lt;/span&gt;)):1}&amp;quot;; let n+=1; done
BACULA_MYSQL_PASS=&amp;quot;&lt;span class="nv"&gt;$PASS&lt;/span&gt;&amp;quot;
PASS=&amp;quot;&amp;quot;
n=&amp;quot;&amp;quot;
mysql -e &amp;quot;UPDATE mysql.user SET password=PASSWORD(&amp;#39;&lt;span class="nv"&gt;$BACULA_MYSQL_PASS&lt;/span&gt;&amp;#39;) WHERE user=&amp;#39;bacula&amp;#39;; flush privileges;&amp;quot;
sed -i &amp;quot;s/dbpassword.*/dbpassword = &amp;quot;&lt;span class="nv"&gt;$BACULA_MYSQL_PASS&lt;/span&gt;&amp;quot;/g&amp;quot; /etc/bacula/bacula-dir.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;h5&gt;Конфигурация Storage&lt;/h5&gt;
&lt;p&gt;Создадим каталог на сервере, где мы будем хранить бекапы. Он должен
располагаться на самом большом и незанятом разделе, переполнения которого, по
возможности, не нарушит работу всей системы и/или других сервисов. В данном
случае я расположу его в /backups/, куда будет монтироваться нужный мне
раздел.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;mkdir&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;backups&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Настроим на Bacula Storage в конфигурационном файле &lt;strong&gt;/etc/bacula/bacula-
sd.conf&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;Storage&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;                             &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;definition&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;myself&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;sd&lt;/span&gt;
  &lt;span class="n"&gt;SDPort&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;9103&lt;/span&gt;                  &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Director&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="n"&gt;port&lt;/span&gt;

  &lt;span class="n"&gt;WorkingDirectory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/var/spool/bacula&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Pid&lt;/span&gt; &lt;span class="n"&gt;Directory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/var/run&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Maximum&lt;/span&gt; &lt;span class="n"&gt;Concurrent&lt;/span&gt; &lt;span class="n"&gt;Jobs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;20&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Director&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt;
  &lt;span class="n"&gt;Password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;SDPASSWORD&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Director&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mon&lt;/span&gt;
  &lt;span class="n"&gt;Password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;MODPASSWORD&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Monitor&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;yes&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Device&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;FileStorage&lt;/span&gt;
  &lt;span class="n"&gt;Media&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;File&lt;/span&gt;
  &lt;span class="n"&gt;Archive&lt;/span&gt; &lt;span class="n"&gt;Device&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;backups&lt;/span&gt;
  &lt;span class="n"&gt;LabelMedia&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;yes&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;                   &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;lets&lt;/span&gt; &lt;span class="n"&gt;Bacula&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt; &lt;span class="n"&gt;unlabeled&lt;/span&gt; &lt;span class="n"&gt;media&lt;/span&gt;
  &lt;span class="n"&gt;Random&lt;/span&gt; &lt;span class="n"&gt;Access&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Yes&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="n"&gt;AutomaticMount&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;yes&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;               &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;when&lt;/span&gt; &lt;span class="n"&gt;device&lt;/span&gt; &lt;span class="n"&gt;opened&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;read&lt;/span&gt; &lt;span class="n"&gt;it&lt;/span&gt;
  &lt;span class="n"&gt;RemovableMedia&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="n"&gt;AlwaysOpen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Messages&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Standard&lt;/span&gt;
  &lt;span class="n"&gt;director&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Стартуем сервис и добавляем в автозагрузку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;sd&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;
&lt;span class="n"&gt;chkconfig&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;sd&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h5&gt;Конфигурация Director&lt;/h5&gt;
&lt;p&gt;Теперь нужно задать пароли для всех поднимаемых сервисов.&lt;/p&gt;
&lt;p&gt;Открываем конфигурационный файл Директора &lt;strong&gt;/etc/bacula/bacula-dir.conf&lt;/strong&gt; и
выполняем его настройку, указывая доступы к Storage и Client, а так же к
самому Bacula Server:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;Director&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;                            &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;define&lt;/span&gt; &lt;span class="n"&gt;myself&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt;
  &lt;span class="n"&gt;DIRport&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;9101&lt;/span&gt;                &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;where&lt;/span&gt; &lt;span class="n"&gt;we&lt;/span&gt; &lt;span class="n"&gt;listen&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;UA&lt;/span&gt; &lt;span class="n"&gt;connections&lt;/span&gt;
  &lt;span class="n"&gt;QueryFile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/usr/libexec/bacula/query.sql&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;WorkingDirectory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/var/spool/bacula&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;PidDirectory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/var/run&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Maximum&lt;/span&gt; &lt;span class="n"&gt;Concurrent&lt;/span&gt; &lt;span class="n"&gt;Jobs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
  &lt;span class="n"&gt;Password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;DIRPASSWORD&amp;quot;&lt;/span&gt;         &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Console&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;
  &lt;span class="n"&gt;Messages&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Daemon&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;JobDefs&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;DefaultJob&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Backup&lt;/span&gt;
  &lt;span class="n"&gt;Level&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Incremental&lt;/span&gt;
  &lt;span class="n"&gt;FileSet&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Full Set&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Schedule&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;WeeklyCycle&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Storage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;File&lt;/span&gt;
  &lt;span class="n"&gt;Messages&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Standard&lt;/span&gt;
  &lt;span class="n"&gt;Pool&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;File&lt;/span&gt;
  &lt;span class="n"&gt;Priority&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;
  &lt;span class="n"&gt;Write&lt;/span&gt; &lt;span class="n"&gt;Bootstrap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/var/spool/bacula/%c.bsr&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;This&lt;/span&gt; &lt;span class="n"&gt;creates&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;ASCII&lt;/span&gt; &lt;span class="n"&gt;copy&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;catalog&lt;/span&gt;
  &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Arguments&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;make_catalog_backup&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt; &lt;span class="n"&gt;are&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
  &lt;span class="err"&gt;#&lt;/span&gt;  &lt;span class="n"&gt;make_catalog_backup&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt; 
  &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;This&lt;/span&gt; &lt;span class="n"&gt;deletes&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;copy&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;catalog&lt;/span&gt;
&lt;span class="n"&gt;Job&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt;          &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;BackupMyServ&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;JobDefs&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;DefaultJob&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Client&lt;/span&gt;        &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;myserv&lt;/span&gt;
  &lt;span class="n"&gt;FileSet&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;myserv&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt; 
&lt;span class="n"&gt;FileSet&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;myserv&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Include&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;Options&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;signature&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MD5&lt;/span&gt; &lt;span class="err"&gt;#Для&lt;/span&gt; &lt;span class="err"&gt;сверки&lt;/span&gt; &lt;span class="err"&gt;используем&lt;/span&gt; &lt;span class="n"&gt;MD5&lt;/span&gt;
      &lt;span class="n"&gt;Compression&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;GZIP&lt;/span&gt; &lt;span class="err"&gt;#Используем&lt;/span&gt; &lt;span class="n"&gt;GZIP&lt;/span&gt; &lt;span class="err"&gt;компрессию&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;backups&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;FileSet&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Full Set&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Include&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;Options&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;signature&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MD5&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sbin&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;Exclude&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;spool&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bacula&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;proc&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;journal&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fsck&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Schedule&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;WeeklyCycle&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Run&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Full&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;st&lt;/span&gt; &lt;span class="n"&gt;sun&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt;
  &lt;span class="n"&gt;Run&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Differential&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="n"&gt;nd&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="n"&gt;th&lt;/span&gt; &lt;span class="n"&gt;sun&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt;
  &lt;span class="n"&gt;Run&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Incremental&lt;/span&gt; &lt;span class="n"&gt;mon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;sat&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Schedule&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;WeeklyCycleAfterBackup&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Run&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Full&lt;/span&gt; &lt;span class="n"&gt;sun&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;sat&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;FileSet&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Catalog&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Include&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;Options&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="n"&gt;signature&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MD5&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/var/spool/bacula/bacula.sql&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Client&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;myserv&lt;/span&gt;
  &lt;span class="n"&gt;Address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;myserv&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;example&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;
  &lt;span class="n"&gt;FDPort&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;9102&lt;/span&gt;
  &lt;span class="n"&gt;Catalog&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MyCatalog&lt;/span&gt;
  &lt;span class="n"&gt;Password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;CLIENTPASS&amp;quot;&lt;/span&gt;          &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;FileDaemon&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="n"&gt;Retention&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;30&lt;/span&gt; &lt;span class="n"&gt;days&lt;/span&gt;            &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="mi"&gt;30&lt;/span&gt; &lt;span class="n"&gt;days&lt;/span&gt;
  &lt;span class="n"&gt;Job&lt;/span&gt; &lt;span class="n"&gt;Retention&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt; &lt;span class="n"&gt;months&lt;/span&gt;            &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;six&lt;/span&gt; &lt;span class="n"&gt;months&lt;/span&gt;
  &lt;span class="n"&gt;AutoPrune&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;yes&lt;/span&gt;                     &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Prune&lt;/span&gt; &lt;span class="n"&gt;expired&lt;/span&gt; &lt;span class="n"&gt;Jobs&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Files&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Storage&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;File&lt;/span&gt;
  &lt;span class="n"&gt;Address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;backup&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;example&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;                &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;N&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Use&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;fully&lt;/span&gt; &lt;span class="n"&gt;qualified&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="n"&gt;here&lt;/span&gt;
  &lt;span class="n"&gt;SDPort&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;9103&lt;/span&gt;
  &lt;span class="n"&gt;Password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;STORAGEPASS&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;Device&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;FileStorage&lt;/span&gt;
  &lt;span class="n"&gt;Media&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;File&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Catalog&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MyCatalog&lt;/span&gt;
  &lt;span class="n"&gt;dbname&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;bacula&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;dbuser&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;bacula&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;dbpassword&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;MYSQLPASS&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Messages&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Standard&lt;/span&gt;
  &lt;span class="n"&gt;mailcommand&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/usr/sbin/bsmtp -h localhost -f &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Bacula&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;%&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="s"&gt;&amp;quot; -s &amp;quot;&lt;/span&gt;&lt;span class="n"&gt;Bacula&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="s"&gt;&amp;quot; %r&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;operatorcommand&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/usr/sbin/bsmtp -h localhost -f &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Bacula&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;%&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="s"&gt;&amp;quot; -s &amp;quot;&lt;/span&gt;&lt;span class="n"&gt;Bacula&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Intervention&lt;/span&gt; &lt;span class="n"&gt;needed&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="s"&gt;&amp;quot; %r&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;mail&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;me&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;example&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;skipped&lt;/span&gt;

  &lt;span class="n"&gt;operator&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dcshnik&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;hoster&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mount&lt;/span&gt;
  &lt;span class="n"&gt;console&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;skipped&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;saved&lt;/span&gt;
  &lt;span class="n"&gt;append&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/var/spool/bacula/log&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;skipped&lt;/span&gt;
  &lt;span class="n"&gt;catalog&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Messages&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Daemon&lt;/span&gt;
  &lt;span class="n"&gt;mailcommand&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/usr/sbin/bsmtp -h localhost -f &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Bacula&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;%&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="s"&gt;&amp;quot; -s &amp;quot;&lt;/span&gt;&lt;span class="n"&gt;Bacula&lt;/span&gt; &lt;span class="n"&gt;daemon&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="s"&gt;&amp;quot; %r&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;mail&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;localhost&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;skipped&lt;/span&gt;

  &lt;span class="n"&gt;console&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;skipped&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;saved&lt;/span&gt;
  &lt;span class="n"&gt;append&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/var/log/bacula.log&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;skipped&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Pool&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Default&lt;/span&gt;
  &lt;span class="n"&gt;Pool&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Backup&lt;/span&gt;
  &lt;span class="n"&gt;Recycle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;yes&lt;/span&gt;                       &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Bacula&lt;/span&gt; &lt;span class="n"&gt;can&lt;/span&gt; &lt;span class="n"&gt;automatically&lt;/span&gt; &lt;span class="n"&gt;recycle&lt;/span&gt; &lt;span class="n"&gt;Volumes&lt;/span&gt;
  &lt;span class="n"&gt;AutoPrune&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;yes&lt;/span&gt;                     &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Prune&lt;/span&gt; &lt;span class="n"&gt;expired&lt;/span&gt; &lt;span class="n"&gt;volumes&lt;/span&gt;
  &lt;span class="n"&gt;Volume&lt;/span&gt; &lt;span class="n"&gt;Retention&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;365&lt;/span&gt; &lt;span class="n"&gt;days&lt;/span&gt;         &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;one&lt;/span&gt; &lt;span class="n"&gt;year&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Pool&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;File&lt;/span&gt;
  &lt;span class="n"&gt;Pool&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Backup&lt;/span&gt;
  &lt;span class="n"&gt;Recycle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;yes&lt;/span&gt;                       &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Bacula&lt;/span&gt; &lt;span class="n"&gt;can&lt;/span&gt; &lt;span class="n"&gt;automatically&lt;/span&gt; &lt;span class="n"&gt;recycle&lt;/span&gt; &lt;span class="n"&gt;Volumes&lt;/span&gt;
  &lt;span class="n"&gt;AutoPrune&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;yes&lt;/span&gt;                     &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Prune&lt;/span&gt; &lt;span class="n"&gt;expired&lt;/span&gt; &lt;span class="n"&gt;volumes&lt;/span&gt;
  &lt;span class="n"&gt;Volume&lt;/span&gt; &lt;span class="n"&gt;Retention&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;365&lt;/span&gt; &lt;span class="n"&gt;days&lt;/span&gt;         &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;one&lt;/span&gt; &lt;span class="n"&gt;year&lt;/span&gt;
  &lt;span class="n"&gt;Maximum&lt;/span&gt; &lt;span class="n"&gt;Volume&lt;/span&gt; &lt;span class="n"&gt;Bytes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;&lt;span class="n"&gt;G&lt;/span&gt;          &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Limit&lt;/span&gt; &lt;span class="n"&gt;Volume&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;something&lt;/span&gt; &lt;span class="n"&gt;reasonable&lt;/span&gt;
  &lt;span class="n"&gt;Maximum&lt;/span&gt; &lt;span class="n"&gt;Volumes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;               &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="n"&gt;Limit&lt;/span&gt; &lt;span class="n"&gt;number&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;Volumes&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="n"&gt;Pool&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Pool&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Scratch&lt;/span&gt;
  &lt;span class="n"&gt;Pool&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Backup&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;Console&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mon&lt;/span&gt;
  &lt;span class="n"&gt;Password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;MODPASS&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;CommandACL&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Запускаем директора и добавляем его в автозагрузку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;
&lt;span class="n"&gt;chkconfig&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h5&gt;Конфигурация Console&lt;/h5&gt;
&lt;p&gt;Для управления Bacula существует несколько интерфейсов. Я предпочитаю CLI-
интефейс bconsole. Его мы сейчас и настроем в &lt;strong&gt;/etc/bacula/bconsole.conf&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;Director&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;Name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt;
  &lt;span class="n"&gt;DIRport&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;9101&lt;/span&gt;
  &lt;span class="n"&gt;address&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;localhost&lt;/span&gt;
  &lt;span class="n"&gt;Password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;DIRPASSWORD&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Проверяем:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;# bconsole &lt;/span&gt;
&lt;span class="n"&gt;Connecting&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;Director&lt;/span&gt; &lt;span class="n"&gt;localhost&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;9101&lt;/span&gt;
&lt;span class="mi"&gt;1000&lt;/span&gt; &lt;span class="n"&gt;OK&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt; &lt;span class="n"&gt;Version&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;5.0.0&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt; &lt;span class="n"&gt;January&lt;/span&gt; &lt;span class="mi"&gt;2010&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Enter&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;period&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;cancel&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;quit&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Доступ есть. Переходим к настройке бекапов и первому, тестовому запуску
задания.&lt;/p&gt;
&lt;h5&gt;Создание volume и тестовый запуск бекапов&lt;/h5&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;# bconsole &lt;/span&gt;
&lt;span class="n"&gt;Connecting&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;Director&lt;/span&gt; &lt;span class="n"&gt;localhost&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;9101&lt;/span&gt;
&lt;span class="mi"&gt;1000&lt;/span&gt; &lt;span class="n"&gt;OK&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt; &lt;span class="n"&gt;Version&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;5.0.0&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt; &lt;span class="n"&gt;January&lt;/span&gt; &lt;span class="mi"&gt;2010&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Enter&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;period&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;cancel&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;label&lt;/span&gt;
&lt;span class="n"&gt;Automatically&lt;/span&gt; &lt;span class="n"&gt;selected&lt;/span&gt; &lt;span class="n"&gt;Catalog&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;MyCatalog&lt;/span&gt;
&lt;span class="n"&gt;Using&lt;/span&gt; &lt;span class="n"&gt;Catalog&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;MyCatalog&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;Automatically&lt;/span&gt; &lt;span class="n"&gt;selected&lt;/span&gt; &lt;span class="n"&gt;Storage&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;File&lt;/span&gt;
&lt;span class="n"&gt;Enter&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt; &lt;span class="n"&gt;Volume&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;TestVolume&lt;/span&gt;
&lt;span class="n"&gt;Defined&lt;/span&gt; &lt;span class="n"&gt;Pools&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
     &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Default&lt;/span&gt;
     &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;File&lt;/span&gt;
     &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Scratch&lt;/span&gt;
&lt;span class="n"&gt;Select&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;Pool&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Запускаем процесс бекапа клиента:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;# bconsole &lt;/span&gt;
&lt;span class="n"&gt;Connecting&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;Director&lt;/span&gt; &lt;span class="n"&gt;localhost&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;9101&lt;/span&gt;
&lt;span class="mi"&gt;1000&lt;/span&gt; &lt;span class="n"&gt;OK&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt; &lt;span class="n"&gt;Version&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;5.0.0&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt; &lt;span class="n"&gt;January&lt;/span&gt; &lt;span class="mi"&gt;2010&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Enter&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;period&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;cancel&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;
&lt;span class="n"&gt;Automatically&lt;/span&gt; &lt;span class="n"&gt;selected&lt;/span&gt; &lt;span class="n"&gt;Catalog&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;MyVolume&lt;/span&gt;
&lt;span class="n"&gt;Using&lt;/span&gt; &lt;span class="n"&gt;Catalog&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;MyVolume&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;A&lt;/span&gt; &lt;span class="n"&gt;job&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="n"&gt;must&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;specified&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="n"&gt;Automatically&lt;/span&gt; &lt;span class="n"&gt;selected&lt;/span&gt; &lt;span class="n"&gt;Job&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;BackupMyServer&lt;/span&gt;
&lt;span class="n"&gt;Run&lt;/span&gt; &lt;span class="n"&gt;Backup&lt;/span&gt; &lt;span class="n"&gt;job&lt;/span&gt;
&lt;span class="nl"&gt;JobName:&lt;/span&gt;  &lt;span class="n"&gt;BackupMyServer&lt;/span&gt;
&lt;span class="nl"&gt;Level:&lt;/span&gt;    &lt;span class="n"&gt;Incremental&lt;/span&gt;
&lt;span class="nl"&gt;Client:&lt;/span&gt;   &lt;span class="n"&gt;pm&lt;/span&gt;
&lt;span class="nl"&gt;FileSet:&lt;/span&gt;  &lt;span class="n"&gt;pm&lt;/span&gt;
&lt;span class="nl"&gt;Pool:&lt;/span&gt;     &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;From&lt;/span&gt; &lt;span class="n"&gt;Job&lt;/span&gt; &lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nl"&gt;Storage:&lt;/span&gt;  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;From&lt;/span&gt; &lt;span class="n"&gt;Job&lt;/span&gt; &lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nl"&gt;When:&lt;/span&gt;     &lt;span class="mi"&gt;2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;01&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt; &lt;span class="mo"&gt;03&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;
&lt;span class="nl"&gt;Priority:&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="n"&gt;OK&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;yes&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;mod&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;no&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;yes&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Задание отправится в очередь на выполнение. Просмотреть статус его работы
можно командой:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;# bconsole&lt;/span&gt;

&lt;span class="n"&gt;Connecting&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;Director&lt;/span&gt; &lt;span class="n"&gt;localhost&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;9101&lt;/span&gt;
&lt;span class="mi"&gt;1000&lt;/span&gt; &lt;span class="n"&gt;OK&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt; &lt;span class="n"&gt;Version&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;5.0.0&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt; &lt;span class="n"&gt;January&lt;/span&gt; &lt;span class="mi"&gt;2010&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Enter&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;period&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;cancel&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt; &lt;span class="n"&gt;dir&lt;/span&gt;
&lt;span class="n"&gt;bacula&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;dir&lt;/span&gt; &lt;span class="n"&gt;Version&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;5.0.0&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt; &lt;span class="n"&gt;January&lt;/span&gt; &lt;span class="mi"&gt;2010&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;i686&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;pc&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;linux&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;gnu&lt;/span&gt; &lt;span class="n"&gt;redhat&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Final&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Daemon&lt;/span&gt; &lt;span class="n"&gt;started&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="err"&gt;Ян&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2012&lt;/span&gt; &lt;span class="mo"&gt;03&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="n"&gt;Jobs&lt;/span&gt; &lt;span class="n"&gt;run&lt;/span&gt; &lt;span class="n"&gt;since&lt;/span&gt; &lt;span class="n"&gt;started&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
 &lt;span class="nl"&gt;Heap:&lt;/span&gt; &lt;span class="n"&gt;heap&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;135&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;168&lt;/span&gt; &lt;span class="n"&gt;smbytes&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;88&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;613&lt;/span&gt; &lt;span class="n"&gt;max_bytes&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;89&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;166&lt;/span&gt; &lt;span class="n"&gt;bufs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;311&lt;/span&gt; &lt;span class="n"&gt;max_bufs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;317&lt;/span&gt;

&lt;span class="n"&gt;Scheduled&lt;/span&gt; &lt;span class="n"&gt;Jobs&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;Level&lt;/span&gt;          &lt;span class="n"&gt;Type&lt;/span&gt;     &lt;span class="n"&gt;Pri&lt;/span&gt;  &lt;span class="n"&gt;Scheduled&lt;/span&gt;          &lt;span class="n"&gt;Name&lt;/span&gt;               &lt;span class="n"&gt;Volume&lt;/span&gt;
&lt;span class="o"&gt;===================================================================================&lt;/span&gt;
&lt;span class="n"&gt;Incremental&lt;/span&gt;    &lt;span class="n"&gt;Backup&lt;/span&gt;    &lt;span class="mi"&gt;10&lt;/span&gt;  &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="err"&gt;Ян&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2012&lt;/span&gt; &lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="n"&gt;BackupMyServer&lt;/span&gt;           &lt;span class="n"&gt;MyVolume&lt;/span&gt;
&lt;span class="o"&gt;====&lt;/span&gt;

&lt;span class="n"&gt;Running&lt;/span&gt; &lt;span class="n"&gt;Jobs&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="n"&gt;Console&lt;/span&gt; &lt;span class="n"&gt;connected&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="err"&gt;Ян&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2012&lt;/span&gt; &lt;span class="mo"&gt;03&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="n"&gt;Console&lt;/span&gt; &lt;span class="n"&gt;connected&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="err"&gt;Ян&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2012&lt;/span&gt; &lt;span class="mo"&gt;03&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="n"&gt;Console&lt;/span&gt; &lt;span class="n"&gt;connected&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="err"&gt;Ян&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2012&lt;/span&gt; &lt;span class="mo"&gt;03&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;28&lt;/span&gt;
 &lt;span class="n"&gt;JobId&lt;/span&gt; &lt;span class="n"&gt;Level&lt;/span&gt;   &lt;span class="n"&gt;Name&lt;/span&gt;                       &lt;span class="n"&gt;Status&lt;/span&gt;
&lt;span class="o"&gt;======================================================================&lt;/span&gt;
     &lt;span class="mi"&gt;9&lt;/span&gt; &lt;span class="n"&gt;Full&lt;/span&gt;    &lt;span class="n"&gt;BackupMyServer&lt;/span&gt;&lt;span class="mf"&gt;.2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;01&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="n"&gt;_03&lt;/span&gt;&lt;span class="mf"&gt;.11.25&lt;/span&gt;&lt;span class="n"&gt;_04&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;running&lt;/span&gt;
    &lt;span class="mi"&gt;10&lt;/span&gt; &lt;span class="n"&gt;Full&lt;/span&gt;    &lt;span class="n"&gt;BackupMyServer&lt;/span&gt;&lt;span class="mf"&gt;.2012&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;01&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="n"&gt;_03&lt;/span&gt;&lt;span class="mf"&gt;.26.03&lt;/span&gt;&lt;span class="n"&gt;_06&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;waiting&lt;/span&gt; &lt;span class="n"&gt;execution&lt;/span&gt;
&lt;span class="o"&gt;====&lt;/span&gt;
&lt;span class="o"&gt;*&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Заключение&lt;/h2&gt;
&lt;p&gt;Как видно из документации &lt;em&gt;Bacula&lt;/em&gt; - это не самая быстроконфигурируемая
система резервного копирования, но её гибкость и масштабируемость позволяет
поддерживать системы почти что любого уровня сложности и различных задач. В
руководстве, как уже было сказано, была описана базовый установка, что даёт
хорошее представление о том, как это будет работать и главное - имеет ли смысл
идти дальше и разворачивать свою систему Bacula.&lt;/p&gt;</summary></entry><entry><title>Починка MySQL-репликации</title><link href="http://yavorovych.com/pochinka-mysql-replikacii.html" rel="alternate"></link><updated>2012-01-03T09:18:08+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2012-01-03:pochinka-mysql-replikacii.html</id><summary type="html">&lt;h3&gt;Into&lt;/h3&gt;
&lt;p&gt;Предположим, что у нас уже настроена репликация MySQL, но мы увидели ошибку.
Обычно это выглядит так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;show&lt;/span&gt; &lt;span class="n"&gt;slave&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;G&lt;/span&gt;
&lt;span class="o"&gt;***************************&lt;/span&gt; &lt;span class="mf"&gt;1.&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="o"&gt;***************************&lt;/span&gt;
             &lt;span class="nl"&gt;Slave_IO_State:&lt;/span&gt; &lt;span class="n"&gt;Waiting&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;master&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;send&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;
                &lt;span class="nl"&gt;Master_Host:&lt;/span&gt; &lt;span class="mf"&gt;192.168.0.1&lt;/span&gt;
                &lt;span class="nl"&gt;Master_User:&lt;/span&gt; &lt;span class="n"&gt;db_name&lt;/span&gt;
                &lt;span class="nl"&gt;Master_Port:&lt;/span&gt; &lt;span class="mi"&gt;3306&lt;/span&gt;
              &lt;span class="nl"&gt;Connect_Retry:&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt;
            &lt;span class="nl"&gt;Master_Log_File:&lt;/span&gt; &lt;span class="n"&gt;mysqld&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="mf"&gt;.000008&lt;/span&gt;
        &lt;span class="nl"&gt;Read_Master_Log_Pos:&lt;/span&gt; &lt;span class="mi"&gt;609198672&lt;/span&gt;
             &lt;span class="nl"&gt;Relay_Log_File:&lt;/span&gt; &lt;span class="n"&gt;se&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;relay&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="mf"&gt;.000276&lt;/span&gt;
              &lt;span class="nl"&gt;Relay_Log_Pos:&lt;/span&gt; &lt;span class="mi"&gt;241568916&lt;/span&gt;
      &lt;span class="nl"&gt;Relay_Master_Log_File:&lt;/span&gt; &lt;span class="n"&gt;mysqld&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="mf"&gt;.000008&lt;/span&gt;
           &lt;span class="nl"&gt;Slave_IO_Running:&lt;/span&gt; &lt;span class="n"&gt;Yes&lt;/span&gt;
          &lt;span class="nl"&gt;Slave_SQL_Running:&lt;/span&gt; &lt;span class="n"&gt;No&lt;/span&gt;
            &lt;span class="nl"&gt;Replicate_Do_DB:&lt;/span&gt; &lt;span class="n"&gt;db_name&lt;/span&gt;
        &lt;span class="nl"&gt;Replicate_Ignore_DB:&lt;/span&gt;
         &lt;span class="nl"&gt;Replicate_Do_Table:&lt;/span&gt;
     &lt;span class="nl"&gt;Replicate_Ignore_Table:&lt;/span&gt;
    &lt;span class="nl"&gt;Replicate_Wild_Do_Table:&lt;/span&gt;
&lt;span class="nl"&gt;Replicate_Wild_Ignore_Table:&lt;/span&gt;
                 &lt;span class="nl"&gt;Last_Errno:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
                 &lt;span class="nl"&gt;Last_Error:&lt;/span&gt; &lt;span class="n"&gt;Query&lt;/span&gt; &lt;span class="n"&gt;caused&lt;/span&gt; &lt;span class="n"&gt;different&lt;/span&gt; &lt;span class="n"&gt;errors&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;master&lt;/span&gt; &lt;span class="n"&gt;and&lt;/span&gt; &lt;span class="n"&gt;slave&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;master&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;Invalid&lt;/span&gt; &lt;span class="n"&gt;error&lt;/span&gt; &lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;126&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;slave&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;no&lt;/span&gt; &lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt; &lt;span class="n"&gt;Default&lt;/span&gt; &lt;span class="n"&gt;database&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;db_name&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Query&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;DELETE&lt;/span&gt; &lt;span class="n"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;sess&lt;/span&gt; &lt;span class="n"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="n"&gt;IN&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5315971&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315968&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315967&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315965&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315963&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315962&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315961&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315960&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315959&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315958&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315957&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315956&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315955&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315954&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315953&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315952&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315950&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315949&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315948&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315947&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315946&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315945&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315944&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315942&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315941&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315939&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315938&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315937&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315936&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315935&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315934&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315933&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315932&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315931&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315929&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315928&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315927&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315924&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315923&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315922&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315921&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315920&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315918&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315917&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315916&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315914&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315912&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315910&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315908&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315907&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315906&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315904&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315903&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315902&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315901&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315899&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315898&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315897&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315896&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315895&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315894&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315893&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315892&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315891&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315890&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315888&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315887&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315886&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315884&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315882&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315881&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315880&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315879&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315878&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315877&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315876&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315875&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315874&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315873&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315871&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315870&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315869&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315865&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315864&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315863&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315862&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315861&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315860&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315858&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315857&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315856&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5315855&lt;/span&gt;
               &lt;span class="nl"&gt;Skip_Counter:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
        &lt;span class="nl"&gt;Exec_Master_Log_Pos:&lt;/span&gt; &lt;span class="mi"&gt;578805429&lt;/span&gt;
            &lt;span class="nl"&gt;Relay_Log_Space:&lt;/span&gt; &lt;span class="mi"&gt;271962159&lt;/span&gt;
            &lt;span class="nl"&gt;Until_Condition:&lt;/span&gt; &lt;span class="n"&gt;None&lt;/span&gt;
             &lt;span class="nl"&gt;Until_Log_File:&lt;/span&gt;
              &lt;span class="nl"&gt;Until_Log_Pos:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
         &lt;span class="nl"&gt;Master_SSL_Allowed:&lt;/span&gt; &lt;span class="n"&gt;No&lt;/span&gt;
         &lt;span class="nl"&gt;Master_SSL_CA_File:&lt;/span&gt;
         &lt;span class="nl"&gt;Master_SSL_CA_Path:&lt;/span&gt;
            &lt;span class="nl"&gt;Master_SSL_Cert:&lt;/span&gt;
          &lt;span class="nl"&gt;Master_SSL_Cipher:&lt;/span&gt;
             &lt;span class="nl"&gt;Master_SSL_Key:&lt;/span&gt;
      &lt;span class="nl"&gt;Seconds_Behind_Master:&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;
&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.00&lt;/span&gt; &lt;span class="n"&gt;sec&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Сперва нам нужно создать актуальный дамп базы данных, сохранив имя файла
бинарных логов и последнюю позицию. Ранее это делалось мной руками, а сегодня
я узнал о такой замечательной опции mysqldump, как --master-data, которую мы и
будем использовать. '''--master-data''' добавляет в sql-dump "CHANGE MASTER" с
актуальными данными, что позволяет не выполнять лишних действий.&lt;/p&gt;
&lt;h3&gt;Master&lt;/h3&gt;
&lt;p&gt;Запрещаем write-операции на master-сервере:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;FLUSH&lt;/span&gt; &lt;span class="n"&gt;TABLES&lt;/span&gt; &lt;span class="n"&gt;WITH&lt;/span&gt; &lt;span class="n"&gt;READ&lt;/span&gt; &lt;span class="n"&gt;LOCK&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Создаём sql-dump реплизируемой базы, включая "CHANGE MASTER":&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;mysqldump&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;master&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="n"&gt;db_name&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;db_name&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Не забываем разлочить таблицы:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;SET&lt;/span&gt; &lt;span class="n"&gt;GLOBAL&lt;/span&gt; &lt;span class="n"&gt;read_only&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;OFF&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь копируем созданный dump на все слейвы.&lt;/p&gt;
&lt;h3&gt;Slave&lt;/h3&gt;
&lt;p&gt;Останавливаем репликацию и на всякий случай ресетим данные бинарного лога.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;stop&lt;/span&gt; &lt;span class="n"&gt;slave&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;reset&lt;/span&gt; &lt;span class="n"&gt;slave&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Восстанавливаем реплицируемую БД из sql-dump'а (сразу выполнится CHANGE
MASTER. Мы расчитываем на то, что настройки доступа к master-серверу уже
прописаны в my.cnf и MySQL быз запущен с ними)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;cat&lt;/span&gt; &lt;span class="n"&gt;db_name&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;mysql&lt;/span&gt; &lt;span class="n"&gt;db_name&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Запускаем репликацию и проверяем статус.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="n"&gt;slave&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;show&lt;/span&gt; &lt;span class="n"&gt;slave&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;G&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary></entry><entry><title>Алерты о логинах в SSH</title><link href="http://yavorovych.com/alerty-o-loginah-v-ssh.html" rel="alternate"></link><updated>2011-10-19T03:04:08+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2011-10-19:alerty-o-loginah-v-ssh.html</id><summary type="html">&lt;p&gt;Недавно один из моих серверов был скомпрометирован а следом и 3 других, к
которым основной сервер имел доступ. История не столь интересная, чтобы
описывать её, да и желания нету. Вместо стандартных советов типа "не вешайте
SSH на дефолтный порт, не давайте логинится от рута и ограничивайте доступ к
портам по возможности" (а это очень важные советы, я очень рекомендую им
следовать) хочу предоставить простой скрипт, что будет алертить каждый раз,
когда кто либо будет логинится по SSH к вам на сервер. Возможно, подобные
алерты могут немного раздражать, но нельзя переоценить их надобность. После
установки руткита какую либо информацию вытащить будет сложно, а у Вас,
возможно, будет несколько ценных писем с адресами.&lt;/p&gt;
&lt;p&gt;Итак, сам код:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;$SSH_CONNECTION&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;];&lt;/span&gt; &lt;span class="n"&gt;then&lt;/span&gt;
            &lt;span class="n"&gt;DATE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;+%d.%m.%Y %Hh%Mm&amp;quot;&lt;/span&gt;
            &lt;span class="n"&gt;IP&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;SSH_CONNECTION&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;awk&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;
            &lt;span class="n"&gt;REVERSE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;dig&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;IP&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="kt"&gt;short&lt;/span&gt;
            &lt;span class="n"&gt;WHO&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;whois&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;IP&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;grep&lt;/span&gt; &lt;span class="n"&gt;desc&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;tail&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;cut&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;SERVER_IPS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ip&lt;/span&gt; &lt;span class="n"&gt;addr&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;awk&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;inet&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;tr&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;\n&amp;#39;&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39; &amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;MESSAGE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Subject: [SSH Alert] Connection from $USER on $HOSTNAME (echo $SERVER_IPS | cut -f 3 -d &amp;#39; &amp;#39;)&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;MESSAGE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;MESSAGEecho&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;ISP        : $WHO &lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;
            &lt;span class="n"&gt;MESSAGE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;MESSAGEecho&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;Host       : $REVERSE &lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;
            &lt;span class="n"&gt;MESSAGE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;MESSAGEecho&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;Date       : $DATE &lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;
            &lt;span class="n"&gt;MESSAGE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;MESSAGEecho&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;Server IPs : $SERVER_IPS &lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;$MESSAGE&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;sendmail&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;postfix&lt;/span&gt; &lt;span class="n"&gt;yavorovich&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;denni&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;
    &lt;span class="n"&gt;fi&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как видно для работы нужен dig, ip и whois. Так же я использую
sendmail.postfix для отправки сообщений, но это по желанию, так сказать.&lt;/p&gt;</summary></entry><entry><title>Notice: Undefined variable: HTTP_SERVER_VARS</title><link href="http://yavorovych.com/notice-undefined-variable-http_server_vars.html" rel="alternate"></link><updated>2010-11-01T03:54:14+02:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2010-11-01:notice-undefined-variable-http_server_vars.html</id><summary type="html">&lt;p&gt;Пока я не увидел эту ошибку, во время поднятия nginx + php-fpm я потратил
больше 4 часов на поиски причины того, что инклуды в скриптах с абсолютными
путями не работают. Как оказалось - дело было не в инклудах. Просто переменная
HTTP_SERVER_VARS была Undefined :)&lt;/p&gt;
&lt;p&gt;Решается эта незадача просто - нужно всё то включить &lt;strong&gt;register_long_arrays&lt;/strong&gt;&lt;/p&gt;</summary></entry><entry><title>Background с цитатами из forismatic.com</title><link href="http://yavorovych.com/bg-foristmatic.html" rel="alternate"></link><updated>2010-06-29T05:59:00+03:00</updated><author><name>Даниэль Яворович</name></author><id>tag:yavorovych.com,2010-06-29:bg-foristmatic.html</id><summary type="html">&lt;p&gt;forismatic.com - это база, что содержит "вдохновляющие высказывания
человечества". Услышал я о этом сервисе на каком то irc сервере внутри глубин
канала #freebsd (емнип). Собеседник сказал, что
http://ru.forismatic.com/homepage уже давно живёт на его home page в Safari.
Признаюсь - я не отличился от него, узнав о сервисе.&lt;/p&gt;
&lt;p&gt;Домашняя страничка в браузере - это, конечно, хорошо. Вот только видеть её
приходится оочень редко (несомненно, кто то найдёт в этом +). Мой выбор -
цитаты на рабочем столе. Сам forismatic.com предоставляет только ПО для win-
систем, зато предоставляет дружественный API. Так что я решил написать пару
строчек кода для этого решения:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
 &lt;span class="mi"&gt;2&lt;/span&gt;
 &lt;span class="mi"&gt;3&lt;/span&gt;
 &lt;span class="mi"&gt;4&lt;/span&gt;
 &lt;span class="mi"&gt;5&lt;/span&gt;
 &lt;span class="mi"&gt;6&lt;/span&gt;
 &lt;span class="mi"&gt;7&lt;/span&gt;
 &lt;span class="mi"&gt;8&lt;/span&gt;
 &lt;span class="mi"&gt;9&lt;/span&gt;
&lt;span class="mi"&gt;10&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;
&lt;span class="mi"&gt;12&lt;/span&gt;
&lt;span class="mi"&gt;13&lt;/span&gt;
&lt;span class="mi"&gt;14&lt;/span&gt;
&lt;span class="mi"&gt;15&lt;/span&gt;
&lt;span class="mi"&gt;16&lt;/span&gt;
&lt;span class="mi"&gt;17&lt;/span&gt;
&lt;span class="mi"&gt;18&lt;/span&gt;
&lt;span class="mi"&gt;19&lt;/span&gt;
&lt;span class="mi"&gt;20&lt;/span&gt;
&lt;span class="mi"&gt;21&lt;/span&gt;
&lt;span class="mi"&gt;22&lt;/span&gt;
&lt;span class="mi"&gt;23&lt;/span&gt;

&lt;span class="cp"&gt;#!/bin/bash&lt;/span&gt;
&lt;span class="cp"&gt;# Background config&lt;/span&gt;
&lt;span class="n"&gt;SIZE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;1280x1024&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;FONT_SIZE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;
&lt;span class="n"&gt;BG_COLOR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;black&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;TEXT_COLOR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;white&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;FONT_PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/usr/share/fonts/truetype/freefont/FreeSerifItalic.ttf&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;POSITION&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;center&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;BG_IMAGE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/home/denni/Picturies/Backgrounds/background.png&amp;quot;&lt;/span&gt;

&lt;span class="cp"&gt;# Forismatic API config&lt;/span&gt;
&lt;span class="n"&gt;KEY&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;457653&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;LANG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ru&amp;quot;&lt;/span&gt;


&lt;span class="n"&gt;API_QUERY&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://api.forismatic.com/api/1.0/?method=getQuote&amp;amp;key=$KEY&amp;amp;format=text&amp;amp;lang=$LANG&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;RESULT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;curl&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;API_QUERY&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;null&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;
&lt;span class="n"&gt;TEXT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;RESULT&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;awk&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;F&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;(&amp;#39;&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;sed&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;sed&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;g&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;`&lt;/span&gt;
&lt;span class="n"&gt;AUTHOR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;RESULT&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;awk&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;F&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;(&amp;#39;&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;tr&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="sc"&gt;&amp;#39;)&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;$AUTHOR&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;];&lt;/span&gt; &lt;span class="n"&gt;then&lt;/span&gt;
    &lt;span class="n"&gt;AUTHOR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;- $AUTHOR -&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;fi&lt;/span&gt;
&lt;span class="n"&gt;convert&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;SIZE&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;background&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;BG_COLOR&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;TEXT_COLOR&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;font&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;FONT_PATH&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;pointsize&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;FONT_SIZE&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;gravity&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;POSITION&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s"&gt; $TEXT&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;\\&lt;/span&gt;&lt;span class="s"&gt;n&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s"&gt;n$AUTHOR&amp;quot;&lt;/span&gt; &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;BG_IMAGE&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь делаем скрипт исполняемым и добавляем в crontab:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;chmod&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;denni&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;forismatic_background&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;crontab&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;
&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;  &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;denni&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;forismatic_background&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;null&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;У меня нету картинки на бекграунде. Если это кому то нужно - милости прошу в&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;man&lt;/span&gt; &lt;span class="n"&gt;convert&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Но главное не реализация, а контент, что станет доступным. Лично на меня
многое из прочитанного заинтересовало.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Gerda 3D" src="http://yavorovych.com/images/bg-foristmatic/bg.png" /&gt;&lt;/p&gt;</summary></entry></feed>